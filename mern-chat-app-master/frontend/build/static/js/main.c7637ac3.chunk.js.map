{"version":3,"sources":["Context/ChatProvider.js","components/Authentication/Login.js","components/Authentication/Signup.js","Pages/Homepage.js","config/ChatLogics.js","components/miscellaneous/ProfileModal.js","components/ScrollableChat.js","components/userAvatar/UserBadgeItem.js","components/userAvatar/UserListItem.js","components/miscellaneous/UpdateGroupChatModal.js","components/SingleChat.js","components/Chatbox.js","components/ChatLoading.js","components/miscellaneous/GroupChatModal.js","components/MyChats.js","components/miscellaneous/UserProfileModal.js","components/miscellaneous/SideDrawer.js","Pages/Chatpage.js","App.js","reportWebVitals.js","index.js"],"names":["ChatContext","createContext","ChatState","useContext","ChatProvider","_ref","children","selectedChat","setSelectedChat","useState","user","setUser","notification","setNotification","chats","setChats","history","useHistory","useEffect","userInfo","JSON","parse","localStorage","getItem","console","log","push","_jsx","Provider","value","async","decryptPrivateKey","encryptedData","password","salt","Uint8Array","from","atob","c","charCodeAt","iv","cipherBytes","cipher","aesKey","enc","TextEncoder","keyMaterial","crypto","subtle","importKey","encode","name","deriveKey","iterations","hash","length","deriveAesKey","decrypted","decrypt","e","error","Login","show","setShow","toast","useToast","email","setEmail","setPassword","loading","setLoading","_jsxs","_Fragment","className","type","placeholder","onChange","target","onClick","handleClick","title","status","duration","isClosable","position","config","headers","data","axios","post","encryptedPrivateKeyJson","concat","description","encryptedPrivateKey","privateKey","privateKeyJwk","exportKey","sessionStorage","setItem","stringify","message","publicKey","_objectSpread","_error$response","_error$response$data","response","disabled","Signup","setName","setPublicKey","setPrivateKey","confirmpassword","setConfirmpassword","pic","setPic","picLoading","setPicLoading","arrayBufferToBase64","buffer","bytes","binary","i","byteLength","String","fromCharCode","btoa","encryptPrivateKey","privateKeyArrayBuffer","window","getRandomValues","encrypted","encrypt","id","accept","pics","undefined","FormData","append","fetch","method","body","then","res","json","url","toString","catch","err","postDetails","files","htmlFor","keyPair","generateKey","modulusLength","publicExponent","spki","publicB64","publicPem","match","join","pkcs8","privateB64","privatePem","publicKeyPem","b64","exportPublicKeyToPem","privateKeyBytes","exportPrivateKeyBytes","encryptedPrivate","currentUserName","key","endsWith","removeItem","clearOldPrivateKeys","Homepage","activeTab","setActiveTab","isSameSender","messages","m","userId","sender","_id","isLastMessage","getSender","loggedUser","users","_users$","ProfileModal","isOpen","onOpen","onClose","useDisclosure","IconButton","display","base","icon","ViewIcon","bg","color","_hover","Modal","size","isCentered","ModalOverlay","ModalContent","ModalHeader","ModalCloseButton","ModalBody","Image","borderRadius","boxSize","src","alt","Text","ModalFooter","ScrollableChat","ScrollableFeed","map","Tooltip","label","placement","hasArrow","Avatar","style","width","startsWith","UserBadgeItem","handleFunction","admin","Badge","px","py","mb","variant","fontSize","colorScheme","cursor","CloseIcon","pl","UserListItem","Box","background","w","d","alignItems","mr","UpdateGroupChatModal","fetchMessages","fetchAgain","setFetchAgain","groupChatName","setGroupChatName","search","setSearch","searchResult","setSearchResult","renameloading","setRenameLoading","handleAddUser","find","u","user1","groupAdmin","Authorization","token","put","chatId","handleRemove","fontFamily","justifyContent","chatName","flexDir","flexWrap","pb","FormControl","Input","Button","ml","isLoading","query","get","handleSearch","Spinner","ENDPOINT","location","hostname","origin","socket","selectedChatCompare","encryptMessageForUser","pemBody","replace","binaryDer","encoded","encryptedB64","decryptMessage","encryptedBytes","arrayBufferFromBase64","decoded","TextDecoder","decode","warn","SingleChat","setMessages","newMessage","setNewMessage","socketConnected","setSocketConnected","typing","setTyping","istyping","setIsTyping","socketInstance","setSocketInstance","socketConn","io","transports","withCredentials","on","emit","mounted","privateKeyJwkStr","decryptStoredPrivateKey","init","isRefresh","arguments","decryptedMessages","msg","_msg$destinatario","_msg$sender","destinatario","chat","clear","content","filter","_m$decrypted","_m$content","includes","handleIncoming","newMsg","n","finalMsg","prev","some","off","sendMessage","isEnter","event","chatInfo","encryptedMessages","member","destinatarioId","createdMessages","Promise","all","forEach","p","ArrowBackIcon","isGroupChat","toUpperCase","lastTypingTime","Date","getTime","setTimeout","onKeyDown","trim","getSenderFull","Chatbox","ChatLoading","Stack","Skeleton","height","GroupChatModal","selectedUsers","setSelectedUsers","handleDelete","delUser","sel","slice","handleGroup","userToAdd","MyChats","setLoggedUser","availableUsers","setAvailableUsers","loadingUsers","setLoadingUsers","fetchChats","fetchAvailableUsers","AddIcon","_getSender","_getSender$","_chat$chatName$","latestMessage","substring","availableUser","accessChat","UserProfileModal","isDeleteOpen","setIsDeleteOpen","isEditing","setIsEditing","cancelRef","useRef","confirmPassword","setConfirmPassword","onDeleteClose","VStack","spacing","FormLabel","InputGroup","InputRightElement","h","updateData","oldPrivateKey","textAlign","AlertDialog","leastDestructiveRef","AlertDialogOverlay","AlertDialogContent","AlertDialogHeader","AlertDialogBody","AlertDialogFooter","ref","delete","_error$response2","_error$response2$data","SideDrawer","loadingChat","setLoadingChat","Menu","MenuButton","NotificationBadge","count","effect","Effect","SCALE","BellIcon","MenuList","MenuItem","notif","ChevronDownIcon","MenuDivider","logoutHandler","Drawer","DrawerOverlay","DrawerContent","DrawerHeader","DrawerBody","Chatpage","App","Route","path","component","exact","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","theme","extendTheme","colors","brand","50","100","200","300","400","500","600","700","800","900","navy","initialColorMode","useSystemColorMode","styles","global","zIndices","hide","auto","docked","dropdown","sticky","banner","overlay","modal","popover","skipLink","tooltip","ReactDOM","render","ChakraProvider","BrowserRouter","document","getElementById"],"mappings":"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","file":"static/js/main.c7637ac3.chunk.js","sourcesContent":["import React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nconst ChatContext = createContext();\r\n\r\nconst ChatProvider = ({ children }) => {\r\n  const [selectedChat, setSelectedChat] = useState();\r\n  const [user, setUser] = useState();\r\n  const [notification, setNotification] = useState([]);\r\n  const [chats, setChats] = useState();\r\n\r\n  const history = useHistory();\r\n\r\n  useEffect(() => {\r\n    const userInfo = JSON.parse(localStorage.getItem(\"userInfo\")  || \"null\");\r\n    setUser(userInfo);\r\n\r\n    if (!userInfo) {\r\n      console.log(\"No user info found, redirecting to homepage\"); \r\n      history.push(\"/\");\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [history]);\r\n\r\n  return (\r\n    <ChatContext.Provider\r\n      value={{\r\n        selectedChat,\r\n        setSelectedChat,\r\n        user,\r\n        setUser,\r\n        notification,\r\n        setNotification,\r\n        chats,\r\n        setChats,\r\n      }}\r\n    >\r\n      {children}\r\n    </ChatContext.Provider>\r\n  );\r\n};\r\n\r\nexport const ChatState = () => {\r\n  return useContext(ChatContext);\r\n};\r\n\r\nexport default ChatProvider;\r\n","import { Button } from \"@chakra-ui/button\";\r\nimport { FormControl, FormLabel } from \"@chakra-ui/form-control\";\r\nimport { Input, InputGroup, InputRightElement } from \"@chakra-ui/input\";\r\nimport { VStack } from \"@chakra-ui/layout\";\r\nimport { useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useToast } from \"@chakra-ui/react\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { ChatState } from \"../../Context/ChatProvider\";\r\n\r\n// FunÃ§Ã£o auxiliar para derivar a chave AES da senha\r\nasync function deriveAesKey(password, salt) {\r\n  const enc = new TextEncoder();\r\n    const keyMaterial = await crypto.subtle.importKey(\r\n    \"raw\",\r\n    enc.encode(password),\r\n    { name: \"PBKDF2\" },\r\n    false,\r\n    [\"deriveKey\"]\r\n  );\r\n\r\n  return crypto.subtle.deriveKey(\r\n    {\r\n      name: \"PBKDF2\",\r\n      salt,\r\n      iterations: 100000,\r\n      hash: \"SHA-256\",\r\n    },\r\n    keyMaterial,\r\n    { name: \"AES-GCM\", length: 256 },\r\n    false,\r\n    [\"decrypt\"]\r\n  );\r\n}\r\n\r\n// FunÃ§Ã£o para descriptografar a chave privada armazenada\r\nasync function decryptPrivateKey(encryptedData, password) {\r\n  const salt = Uint8Array.from(atob(encryptedData.salt), c => c.charCodeAt(0));\r\n  const iv = Uint8Array.from(atob(encryptedData.iv), c => c.charCodeAt(0));\r\n  const cipherBytes = Uint8Array.from(atob(encryptedData.cipher), c => c.charCodeAt(0));\r\n\r\n  const aesKey = await deriveAesKey(password, salt);\r\n  let decrypted;\r\n  try {\r\n    decrypted = await crypto.subtle.decrypt(\r\n      { name: \"AES-GCM\", iv },\r\n      aesKey,\r\n      cipherBytes\r\n    );\r\n  } catch (e) {\r\n    console.error(\"Decryption failed:\", e);\r\n    throw e;\r\n  }\r\n\r\n  // Importa diretamente o ArrayBuffer descriptografado\r\n  return await crypto.subtle.importKey(\r\n    \"pkcs8\",\r\n    decrypted,\r\n    {\r\n      name: \"RSA-OAEP\",\r\n      hash: \"SHA-256\",\r\n    },\r\n    true,\r\n    [\"decrypt\"]\r\n  );\r\n}\r\n\r\n\r\nconst Login = () => {\r\n  const [show, setShow] = useState(false);\r\n  const handleClick = () => setShow(!show);\r\n  const toast = useToast();\r\n  const [email, setEmail] = useState();\r\n  const [password, setPassword] = useState();\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const history = useHistory();\r\n  const { setUser } = ChatState();\r\n\r\n  const submitHandler = async () => {\r\n    setLoading(true);\r\n    if (!email || !password) {\r\n      toast({\r\n        title: \"Please Fill all the Feilds\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-type\": \"application/json\",\r\n        },\r\n      };\r\n\r\n      const { data } = await axios.post(\r\n        \"/api/user/login\",\r\n        { email, password },\r\n        config\r\n      );\r\n\r\n      const encryptedPrivateKeyJson = localStorage.getItem(`${data.name}_privateKey`);\r\n        if (!encryptedPrivateKeyJson) {\r\n          toast({\r\n          title: \"Private Key Not Found\",\r\n          description: \"Please sign up again to generate encryption keys.\",\r\n          status: \"error\",\r\n          duration: 8000,\r\n          isClosable: true,\r\n          position: \"bottom\",\r\n        });\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const encryptedPrivateKey = JSON.parse(encryptedPrivateKeyJson);\r\n\r\n      // Descriptografa a chave privada com a senha\r\n      let privateKey;\r\n      try {\r\n        privateKey = await decryptPrivateKey(encryptedPrivateKey, password);\r\n\r\n        const privateKeyJwk = await crypto.subtle.exportKey(\"jwk\", privateKey);\r\n\r\n        sessionStorage.setItem(\"privateKeyJwk\", JSON.stringify(privateKeyJwk));\r\n        console.log(\"ðŸ’¾ Chave privada armazenada no sessionStorage.\");\r\n\r\n      } catch (e) {\r\n        console.error(\"Decryption failed:\", e);\r\n        toast({\r\n          description: `Falha ao descriptografar: ${e.message}`,\r\n          status: \"error\",\r\n          duration: 7000,\r\n          isClosable: true,\r\n          position: \"bottom\",\r\n        });\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (data.publicKey) {\r\n        const publicKey = await crypto.subtle.importKey(\r\n          \"spki\",\r\n          Uint8Array.from(atob(data.publicKey), c => c.charCodeAt(0)),\r\n          { name: \"RSA-OAEP\", hash: \"SHA-256\" },\r\n          true,\r\n          [\"encrypt\"]\r\n        );\r\n        setUser({ ...data, privateKey, publicKey });\r\n      }\r\n\r\n      toast({\r\n        title: \"Login Successful\",\r\n        status: \"success\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n\r\n      // Guarda o usuÃ¡rio e a chave descriptografada na memÃ³ria\r\n      setUser({ ...data, privateKey });\r\n      localStorage.setItem(\"userInfo\", JSON.stringify(data));\r\n      \r\n      setLoading(false);\r\n      history.push(\"/chats\");\r\n      } catch (error) {\r\n        toast({\r\n          title: \"Error Occurred!\",\r\n          description: error.response?.data?.message || \"Login failed\",\r\n          status: \"error\",\r\n          duration: 5000,\r\n          isClosable: true,\r\n          position: \"bottom\",\r\n        });\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n  const handleGuestLogin = () => {\r\n    setEmail(\"guest@example.com\");\r\n    setPassword(\"123456\");\r\n  };\r\n  return (\r\n    <>\r\n      <div className=\"form-group\">\r\n        <label className=\"form-label\">Email Address *</label>\r\n        <input\r\n          className=\"form-input\"\r\n          type=\"email\"\r\n          placeholder=\"Enter Your Email Address\"\r\n          value={email}\r\n          onChange={(e) => setEmail(e.target.value)}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <label className=\"form-label\">Password *</label>\r\n        <div className=\"input-with-button\">\r\n          <input\r\n            className=\"form-input\"\r\n            type={show ? \"text\" : \"password\"}\r\n            placeholder=\"Enter password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n          />\r\n          <button\r\n            className=\"show-password-btn\"\r\n            onClick={handleClick}\r\n            type=\"button\"\r\n          >\r\n            {show ? \"Hide\" : \"Show\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <button\r\n        className=\"btn btn-primary\"\r\n        onClick={submitHandler}\r\n        disabled={loading}\r\n      >\r\n        {loading && <span className=\"spinner\"></span>}\r\n        Login\r\n      </button>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Login;","import { Button } from \"@chakra-ui/button\";\r\nimport { FormControl, FormLabel } from \"@chakra-ui/form-control\";\r\nimport { Input, InputGroup, InputRightElement } from \"@chakra-ui/input\";\r\nimport { VStack } from \"@chakra-ui/layout\";\r\nimport { useToast } from \"@chakra-ui/toast\";\r\nimport axios from \"axios\";\r\nimport { useState } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\n\r\nfunction clearOldPrivateKeys(currentUserName) {\r\n  for (let i = 0; i < localStorage.length; i++) {\r\n    const key = localStorage.key(i);\r\n    if (key.endsWith(\"_privateKey\") && key !== `${currentUserName}_privateKey`) {\r\n      localStorage.removeItem(key);\r\n      i--; // ajusta o Ã­ndice porque removemos um item\r\n    }\r\n  }\r\n}\r\n\r\nconst Signup = () => {\r\n  const [show, setShow] = useState(false);\r\n  const handleClick = () => setShow(!show);\r\n  const toast = useToast();\r\n  const history = useHistory();\r\n\r\n  const [name, setName] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [publicKey, setPublicKey] = useState();\r\n  const [privateKey, setPrivateKey] = useState();\r\n  const [confirmpassword, setConfirmpassword] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [pic, setPic] = useState();\r\n  const [picLoading, setPicLoading] = useState(false);\r\n\r\n  const arrayBufferToBase64 = (buffer) => {\r\n    const bytes = new Uint8Array(buffer);\r\n    let binary = \"\";\r\n\r\n    for (let i = 0; i < bytes.byteLength; i++) {\r\n      binary += String.fromCharCode(bytes[i]);\r\n    }\r\n\r\n    return btoa(binary);\r\n  };\r\n\r\n  const base64ToArrayBuffer = (b64) => {\r\n    const binary = atob(b64);\r\n    const len = binary.length;\r\n    const bytes = new Uint8Array(len);\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      bytes[i] = binary.charCodeAt(i);\r\n    }\r\n\r\n    return bytes.buffer;\r\n  };\r\n\r\n  const exportPublicKeyToPem = async (publicKey) => {\r\n    const spki = await window.crypto.subtle.exportKey(\"spki\", publicKey);\r\n    const b64 = arrayBufferToBase64(spki);\r\n    const pem = `-----BEGIN PUBLIC KEY-----\\n${b64.match(/.{1,64}/g).join(\"\\n\")}\\n-----END PUBLIC KEY-----`;\r\n\r\n    return pem;\r\n  };\r\n\r\n  const exportPrivateKeyBytes = async (privateKey) => {\r\n    return await window.crypto.subtle.exportKey(\"pkcs8\", privateKey);\r\n  };\r\n\r\n  const deriveAesKey = async (password, salt) => {\r\n    const enc = new TextEncoder();\r\n    const keyMaterial = await window.crypto.subtle.importKey(\r\n      \"raw\",\r\n      enc.encode(password),\r\n      { name: \"PBKDF2\" },\r\n      false,\r\n      [\"deriveKey\"]\r\n    );\r\n\r\n    return await window.crypto.subtle.deriveKey(\r\n      {\r\n        name: \"PBKDF2\",\r\n        salt,\r\n        iterations: 100000,\r\n        hash: \"SHA-256\",\r\n      },\r\n      keyMaterial,\r\n      { name: \"AES-GCM\", length: 256 },\r\n      false,\r\n      [\"encrypt\", \"decrypt\"]\r\n    );\r\n  };\r\n\r\n\r\n  const encryptPrivateKey = async (privateKeyArrayBuffer, password) => {\r\n    const salt = window.crypto.getRandomValues(new Uint8Array(16));\r\n    const iv = window.crypto.getRandomValues(new Uint8Array(12));\r\n\r\n    const aesKey = await deriveAesKey(password, salt);\r\n    const encrypted = await window.crypto.subtle.encrypt(\r\n      { name: \"AES-GCM\", iv },\r\n      aesKey,\r\n      privateKeyArrayBuffer\r\n    );\r\n\r\n    return {\r\n      cipher: arrayBufferToBase64(encrypted),\r\n      iv: arrayBufferToBase64(iv.buffer),\r\n      salt: arrayBufferToBase64(salt.buffer),\r\n    };\r\n  };\r\n\r\n  \r\n  const submitHandler = async () => {\r\n    setPicLoading(true);\r\n    if (!name || !email || !password || !confirmpassword) {\r\n      toast({\r\n        title: \"Please Fill all the Feilds\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setPicLoading(false);\r\n      return;\r\n    }\r\n    if (password !== confirmpassword) {\r\n      toast({\r\n        title: \"Passwords Do Not Match\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      return;\r\n    }\r\n    console.log(name, email, password, pic);\r\n    try {\r\n      const keyPair = await window.crypto.subtle.generateKey(\r\n        {\r\n          name: \"RSA-OAEP\",\r\n          modulusLength: 2048,\r\n          publicExponent: new Uint8Array([1, 0, 1]),\r\n          hash: \"SHA-256\",\r\n        },\r\n        true,\r\n        [\"encrypt\", \"decrypt\"]\r\n      );\r\n\r\n      //ArrayBuffer -> base64 -> PEM (public + private)\r\n      const spki = await window.crypto.subtle.exportKey(\"spki\", keyPair.publicKey);\r\n      const publicB64 = arrayBufferToBase64(spki);\r\n      const publicPem = `-----BEGIN PUBLIC KEY-----\\n${publicB64.match(/.{1,64}/g).join(\"\\n\")}\\n-----END PUBLIC KEY-----`;\r\n\r\n      const pkcs8 = await window.crypto.subtle.exportKey(\"pkcs8\", keyPair.privateKey);\r\n      const privateB64 = arrayBufferToBase64(pkcs8);\r\n      const privatePem = `-----BEGIN PRIVATE KEY-----\\n${privateB64.match(/.{1,64}/g).join(\"\\n\")}\\n-----END PRIVATE KEY-----`;\r\n\r\n      console.log(\"=== PUBLIC KEY (PEM) ===\\n\", publicPem);\r\n      console.log(\"=== PRIVATE KEY (PEM) ===\\n\", privatePem); \r\n\r\n\r\n      const publicKeyPem = await exportPublicKeyToPem(keyPair.publicKey);\r\n      const privateKeyBytes = await exportPrivateKeyBytes(keyPair.privateKey);\r\n      const encryptedPrivate = await encryptPrivateKey(privateKeyBytes, password);\r\n\r\n      const config = {\r\n        headers: {\r\n        \"Content-type\": \"application/json\",\r\n        },\r\n      };\r\n      const { data } = await axios.post(\r\n        \"/api/user\",\r\n        {\r\n          name,\r\n          email,\r\n          password,\r\n          pic,\r\n          publicKey: publicKeyPem,\r\n        },\r\n        config\r\n      );\r\n\r\n      clearOldPrivateKeys(name);\r\n\r\n      localStorage.setItem(`${name}_privateKey`, JSON.stringify(encryptedPrivate));\r\n\r\n      localStorage.setItem(\"userInfo\", JSON.stringify(data));\r\n\r\n      console.log(data);\r\n      toast({\r\n        title: \"Registration Successful\",\r\n        status: \"success\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      //localStorage.setItem(\"superprivatekey\", privateKey);\r\n\r\n      setPicLoading(false);\r\n      history.push(\"/chats\");\r\n      \r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occured!\",\r\n        description: error.response.data.message,\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setPicLoading(false);\r\n    }\r\n  };\r\n\r\n  const postDetails = (pics) => {\r\n    setPicLoading(true);\r\n    if (pics === undefined) {\r\n      toast({\r\n        title: \"Please Select an Image!\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      return;\r\n    }\r\n    console.log(pics);\r\n    if (pics.type === \"image/jpeg\" || pics.type === \"image/png\") {\r\n      const data = new FormData();\r\n      data.append(\"file\", pics);\r\n      data.append(\"upload_preset\", \"chat-app\");\r\n      data.append(\"cloud_name\", \"piyushproj\");\r\n      fetch(\"https://api.cloudinary.com/v1_1/piyushproj/image/upload\", {\r\n        method: \"post\",\r\n        body: data,\r\n      })\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          setPic(data.url.toString());\r\n          console.log(data.url.toString());\r\n          setPicLoading(false);\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n          setPicLoading(false);\r\n        });\r\n    } else {\r\n      toast({\r\n        title: \"Please Select an Image!\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setPicLoading(false);\r\n      return;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"form-group\">\r\n        <label className=\"form-label\">Name *</label>\r\n        <input\r\n          className=\"form-input\"\r\n          placeholder=\"Enter Your Name\"\r\n          value={name}\r\n          onChange={(e) => setName(e.target.value)}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <label className=\"form-label\">Email Address *</label>\r\n        <input\r\n          className=\"form-input\"\r\n          type=\"email\"\r\n          placeholder=\"Enter Your Email Address\"\r\n          value={email}\r\n          onChange={(e) => setEmail(e.target.value)}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <label className=\"form-label\">Password *</label>\r\n        <div className=\"input-with-button\">\r\n          <input\r\n            className=\"form-input\"\r\n            type={show ? \"text\" : \"password\"}\r\n            placeholder=\"Enter Password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n          />\r\n          <button\r\n            className=\"show-password-btn\"\r\n            onClick={handleClick}\r\n            type=\"button\"\r\n          >\r\n            {show ? \"Hide\" : \"Show\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <label className=\"form-label\">Confirm Password *</label>\r\n        <div className=\"input-with-button\">\r\n          <input\r\n            className=\"form-input\"\r\n            type={show ? \"text\" : \"password\"}\r\n            placeholder=\"Confirm password\"\r\n            value={confirmpassword}\r\n            onChange={(e) => setConfirmpassword(e.target.value)}\r\n          />\r\n          <button\r\n            className=\"show-password-btn\"\r\n            onClick={handleClick}\r\n            type=\"button\"\r\n          >\r\n            {show ? \"Hide\" : \"Show\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <label className=\"form-label\">Upload your Picture</label>\r\n        <div className=\"file-input-wrapper\">\r\n          <input\r\n            type=\"file\"\r\n            id=\"pic-upload\"\r\n            accept=\"image/*\"\r\n            onChange={(e) => postDetails(e.target.files[0])}\r\n          />\r\n          <label htmlFor=\"pic-upload\" className=\"file-input-label\">\r\n            {pic ? \"Image Selected âœ“\" : \"Choose File\"}\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      <button\r\n        className=\"btn btn-signup\"\r\n        onClick={submitHandler}\r\n        disabled={picLoading}\r\n      >\r\n        {picLoading && <span className=\"spinner\"></span>}\r\n        Sign Up\r\n      </button>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Signup;","import { useState, useEffect } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport Login from \"../components/Authentication/Login\";\r\nimport Signup from \"../components/Authentication/Signup\";\r\nimport \"./Homepage.css\";\r\n\r\nfunction Homepage() {\r\n  const history = useHistory();\r\n  const [activeTab, setActiveTab] = useState(\"login\");\r\n\r\n  useEffect(() => {\r\n    const user = JSON.parse(localStorage.getItem(\"userInfo\") || \"null\");\r\n    if (user) history.push(\"/chats\");\r\n  }, [history]);\r\n\r\n  return (\r\n    <div className=\"homepage-container\">\r\n      <div className=\"login-card\">\r\n        <h1 className=\"login-title\">CriptoChat 2.0</h1>\r\n\r\n        <div className=\"tabs-container\">\r\n          <button\r\n            className={`tab-button ${activeTab === \"login\" ? \"active\" : \"\"}`}\r\n            onClick={() => setActiveTab(\"login\")}\r\n          >\r\n            Login\r\n          </button>\r\n          <button\r\n            className={`tab-button ${activeTab === \"signup\" ? \"active\" : \"\"}`}\r\n            onClick={() => setActiveTab(\"signup\")}\r\n          >\r\n            Sign Up\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"form-container\">\r\n          {activeTab === \"login\" ? <Login /> : <Signup />}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Homepage;","export const isSameSenderMargin = (messages, m, i, userId) => {\r\n  // console.log(i === messages.length - 1);\r\n\r\n  if (\r\n    i < messages.length - 1 &&\r\n    messages[i + 1].sender._id === m.sender._id &&\r\n    messages[i].sender._id !== userId\r\n  )\r\n    return 33;\r\n  else if (\r\n    (i < messages.length - 1 &&\r\n      messages[i + 1].sender._id !== m.sender._id &&\r\n      messages[i].sender._id !== userId) ||\r\n    (i === messages.length - 1 && messages[i].sender._id !== userId)\r\n  )\r\n    return 0;\r\n  else return \"auto\";\r\n};\r\n\r\nexport const isSameSender = (messages, m, i, userId) => {\r\n  return (\r\n    i < messages.length - 1 &&\r\n    (messages[i + 1].sender._id !== m.sender._id ||\r\n      messages[i + 1].sender._id === undefined) &&\r\n    messages[i].sender._id !== userId\r\n  );\r\n};\r\n\r\nexport const isLastMessage = (messages, i, userId) => {\r\n  return (\r\n    i === messages.length - 1 &&\r\n    messages[messages.length - 1].sender._id !== userId &&\r\n    messages[messages.length - 1].sender._id\r\n  );\r\n};\r\n\r\nexport const isSameUser = (messages, m, i) => {\r\n  return i > 0 && messages[i - 1].sender._id === m.sender._id;\r\n};\r\n\r\nexport const getSender = (loggedUser, users) => {\r\n  if(users && users.length >=2){\r\n    return users[0]?._id === loggedUser?._id ? users[1].name : users[0].name;\r\n  }\r\n  return \"Nome indisponivel\";\r\n};\r\n\r\nexport const getSenderFull = (loggedUser, users) => {\r\n  return users[0]._id === loggedUser._id ? users[1] : users[0];\r\n};\r\n","import { ViewIcon } from \"@chakra-ui/icons\";\r\nimport {\r\n  Modal,\r\n  ModalOverlay,\r\n  ModalContent,\r\n  ModalHeader,\r\n  ModalFooter,\r\n  ModalBody,\r\n  ModalCloseButton,\r\n  Button,\r\n  useDisclosure,\r\n  IconButton,\r\n  Text,\r\n  Image,\r\n} from \"@chakra-ui/react\";\r\nimport \"./UserProfileModal.css\";\r\n\r\nconst ProfileModal = ({ user, children }) => {\r\n  const { isOpen, onOpen, onClose } = useDisclosure();\r\n\r\n  return (\r\n    <>\r\n      {children ? (\r\n        <span onClick={onOpen}>{children}</span>\r\n      ) : (\r\n        <IconButton\r\n          display={{ base: \"flex\" }}\r\n          icon={<ViewIcon />}\r\n          onClick={onOpen}\r\n          bg=\"transparent\"\r\n          color=\"#00a88e\"\r\n          _hover={{ bg: \"rgba(0, 168, 142, 0.1)\" }}\r\n        />\r\n      )}\r\n      <Modal size=\"lg\" onClose={onClose} isOpen={isOpen} isCentered>\r\n        <ModalOverlay className=\"profile-modal-overlay\" />\r\n        <ModalContent className=\"profile-modal-content\">\r\n          <ModalHeader className=\"profile-modal-header\">\r\n            {user.name}\r\n          </ModalHeader>\r\n          <ModalCloseButton className=\"profile-modal-close\" />\r\n          <ModalBody className=\"profile-modal-body\">\r\n            <div className=\"profile-view-container\">\r\n              <Image\r\n                borderRadius=\"full\"\r\n                boxSize=\"150px\"\r\n                src={user.pic}\r\n                alt={user.name}\r\n                className=\"profile-avatar-large\"\r\n              />\r\n              <div className=\"profile-info\">\r\n                <Text className=\"profile-name\">{user.name}</Text>\r\n                <Text className=\"profile-email\">Email: {user.email}</Text>\r\n              </div>\r\n            </div>\r\n          </ModalBody>\r\n          <ModalFooter className=\"profile-modal-footer\">\r\n            <button className=\"btn-close-modal\" onClick={onClose}>\r\n              Close\r\n            </button>\r\n          </ModalFooter>\r\n        </ModalContent>\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProfileModal;\r\n","import { Avatar } from \"@chakra-ui/avatar\";\r\nimport { Tooltip } from \"@chakra-ui/tooltip\";\r\nimport ScrollableFeed from \"react-scrollable-feed\";\r\nimport {\r\n  isLastMessage,\r\n  isSameSender,\r\n  isSameSenderMargin,\r\n  isSameUser,\r\n} from \"../config/ChatLogics\";\r\nimport { ChatState } from \"../Context/ChatProvider\";\r\n\r\nconst ScrollableChat = ({ messages }) => {\r\n  const { user } = ChatState();\r\n\r\n  return (\r\n    <ScrollableFeed>\r\n      {messages &&\r\n        messages.map((m, i) => (\r\n          <div\r\n            key={m._id}\r\n            className={`message-wrapper ${\r\n              m.sender._id === user._id ? \"sent\" : \"received\"\r\n            }`}\r\n          >\r\n            {/* Avatar para mensagens recebidas */}\r\n            {m.sender._id !== user._id &&\r\n              (isSameSender(messages, m, i, user._id) ||\r\n                isLastMessage(messages, i, user._id)) && (\r\n                <Tooltip\r\n                  label={m.sender.name}\r\n                  placement=\"bottom-start\"\r\n                  hasArrow\r\n                >\r\n                  <Avatar\r\n                    className=\"message-avatar\"\r\n                    name={m.sender.name}\r\n                    src={m.sender.pic}\r\n                    size=\"sm\"\r\n                  />\r\n                </Tooltip>\r\n              )}\r\n\r\n            {/* EspaÃ§amento quando nÃ£o tem avatar */}\r\n            {m.sender._id !== user._id &&\r\n              !isSameSender(messages, m, i, user._id) &&\r\n              !isLastMessage(messages, i, user._id) && (\r\n                <div style={{ width: \"40px\" }}></div>\r\n              )}\r\n\r\n            {/* Bolha da mensagem */}\r\n            <div className=\"message-bubble\">\r\n              {m.decrypted && !m.decrypted.startsWith(\"-----BEGIN\") \r\n              ? m.decrypted \r\n              : \"[Mensagem criptografada]\"}\r\n            </div>\r\n          </div>\r\n        ))}\r\n    </ScrollableFeed>\r\n  );\r\n};\r\n\r\nexport default ScrollableChat;\r\n","import { CloseIcon } from \"@chakra-ui/icons\";\r\nimport { Badge } from \"@chakra-ui/layout\";\r\n\r\nconst UserBadgeItem = ({ user, handleFunction, admin }) => {\r\n  return (\r\n    <Badge\r\n      px={2}\r\n      py={1}\r\n      borderRadius=\"lg\"\r\n      m={1}\r\n      mb={2}\r\n      variant=\"solid\"\r\n      fontSize={12}\r\n      colorScheme=\"purple\"\r\n      cursor=\"pointer\"\r\n      onClick={handleFunction}\r\n    >\r\n      {user.name}\r\n      {admin === user._id && <span> (Admin)</span>}\r\n      <CloseIcon pl={1} />\r\n    </Badge>\r\n  );\r\n};\r\n\r\nexport default UserBadgeItem;\r\n","import { Avatar } from \"@chakra-ui/avatar\";\r\nimport { Box, Text } from \"@chakra-ui/layout\";\r\nimport { ChatState } from \"../../Context/ChatProvider\";\r\n\r\nconst UserListItem = ({user, handleFunction }) => {\r\n\r\n  return (\r\n    <Box\r\n      onClick={handleFunction}\r\n      cursor=\"pointer\"\r\n      bg=\"#E8E8E8\"\r\n      _hover={{\r\n        background: \"#38B2AC\",\r\n        color: \"white\",\r\n      }}\r\n      w=\"100%\"\r\n      d=\"flex\"\r\n      alignItems=\"center\"\r\n      color=\"black\"\r\n      px={3}\r\n      py={2}\r\n      mb={2}\r\n      borderRadius=\"lg\"\r\n    >\r\n      <Avatar\r\n        mr={2}\r\n        size=\"sm\"\r\n        cursor=\"pointer\"\r\n        name={user.name}\r\n        src={user.pic}\r\n      />\r\n      <Box>\r\n        <Text>{user.name}</Text>\r\n        <Text fontSize=\"xs\">\r\n          <b>Email : </b>\r\n          {user.email}\r\n        </Text>\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default UserListItem;\r\n","import { ViewIcon } from \"@chakra-ui/icons\";\r\nimport {\r\n  Modal,\r\n  ModalOverlay,\r\n  ModalContent,\r\n  ModalHeader,\r\n  ModalFooter,\r\n  ModalBody,\r\n  ModalCloseButton,\r\n  Button,\r\n  useDisclosure,\r\n  FormControl,\r\n  Input,\r\n  useToast,\r\n  Box,\r\n  IconButton,\r\n  Spinner,\r\n} from \"@chakra-ui/react\";\r\nimport axios from \"axios\";\r\nimport { useState } from \"react\";\r\nimport { ChatState } from \"../../Context/ChatProvider\";\r\nimport UserBadgeItem from \"../userAvatar/UserBadgeItem\";\r\nimport UserListItem from \"../userAvatar/UserListItem\";\r\n\r\nconst UpdateGroupChatModal = ({ fetchMessages, fetchAgain, setFetchAgain }) => {\r\n  const { isOpen, onOpen, onClose } = useDisclosure();\r\n  const [groupChatName, setGroupChatName] = useState();\r\n  const [search, setSearch] = useState(\"\");\r\n  const [searchResult, setSearchResult] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [renameloading, setRenameLoading] = useState(false);\r\n  const toast = useToast();\r\n\r\n  const { selectedChat, setSelectedChat, user } = ChatState();\r\n\r\n  const handleSearch = async (query) => {\r\n    setSearch(query);\r\n    if (!query) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.get(`/api/user?search=${search}`, config);\r\n      console.log(data);\r\n      setLoading(false);\r\n      setSearchResult(data);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occured!\",\r\n        description: \"Failed to Load the Search Results\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom-left\",\r\n      });\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRename = async () => {\r\n    if (!groupChatName) return;\r\n\r\n    try {\r\n      setRenameLoading(true);\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.put(\r\n        `/api/chat/rename`,\r\n        {\r\n          chatId: selectedChat._id,\r\n          chatName: groupChatName,\r\n        },\r\n        config\r\n      );\r\n\r\n      console.log(data._id);\r\n      // setSelectedChat(\"\");\r\n      setSelectedChat(data);\r\n      setFetchAgain(!fetchAgain);\r\n      setRenameLoading(false);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occured!\",\r\n        description: error.response.data.message,\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setRenameLoading(false);\r\n    }\r\n    setGroupChatName(\"\");\r\n  };\r\n\r\n  const handleAddUser = async (user1) => {\r\n    if (selectedChat.users.find((u) => u._id === user1._id)) {\r\n      toast({\r\n        title: \"User Already in group!\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (selectedChat.groupAdmin._id !== user._id) {\r\n      toast({\r\n        title: \"Only admins can add someone!\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.put(\r\n        `/api/chat/groupadd`,\r\n        {\r\n          chatId: selectedChat._id,\r\n          userId: user1._id,\r\n        },\r\n        config\r\n      );\r\n\r\n      setSelectedChat(data);\r\n      setFetchAgain(!fetchAgain);\r\n      setLoading(false);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occured!\",\r\n        description: error.response.data.message,\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setLoading(false);\r\n    }\r\n    setGroupChatName(\"\");\r\n  };\r\n\r\n  const handleRemove = async (user1) => {\r\n    if (selectedChat.groupAdmin._id !== user._id && user1._id !== user._id) {\r\n      toast({\r\n        title: \"Only admins can remove someone!\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.put(\r\n        `/api/chat/groupremove`,\r\n        {\r\n          chatId: selectedChat._id,\r\n          userId: user1._id,\r\n        },\r\n        config\r\n      );\r\n\r\n      user1._id === user._id ? setSelectedChat() : setSelectedChat(data);\r\n      setFetchAgain(!fetchAgain);\r\n      fetchMessages();\r\n      setLoading(false);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occured!\",\r\n        description: error.response.data.message,\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setLoading(false);\r\n    }\r\n    setGroupChatName(\"\");\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <IconButton d={{ base: \"flex\" }} icon={<ViewIcon />} onClick={onOpen} />\r\n\r\n      <Modal onClose={onClose} isOpen={isOpen} isCentered>\r\n        <ModalOverlay />\r\n        <ModalContent>\r\n          <ModalHeader\r\n            fontSize=\"35px\"\r\n            fontFamily=\"Work sans\"\r\n            d=\"flex\"\r\n            justifyContent=\"center\"\r\n          >\r\n            {selectedChat.chatName}\r\n          </ModalHeader>\r\n\r\n          <ModalCloseButton />\r\n          <ModalBody d=\"flex\" flexDir=\"column\" alignItems=\"center\">\r\n            <Box w=\"100%\" d=\"flex\" flexWrap=\"wrap\" pb={3}>\r\n              {selectedChat.users.map((u) => (\r\n                <UserBadgeItem\r\n                  key={u._id}\r\n                  user={u}\r\n                  admin={selectedChat.groupAdmin}\r\n                  handleFunction={() => handleRemove(u)}\r\n                />\r\n              ))}\r\n            </Box>\r\n            <FormControl d=\"flex\">\r\n              <Input\r\n                placeholder=\"Chat Name\"\r\n                mb={3}\r\n                value={groupChatName}\r\n                onChange={(e) => setGroupChatName(e.target.value)}\r\n              />\r\n              <Button\r\n                variant=\"solid\"\r\n                colorScheme=\"teal\"\r\n                ml={1}\r\n                isLoading={renameloading}\r\n                onClick={handleRename}\r\n              >\r\n                Update\r\n              </Button>\r\n            </FormControl>\r\n            <FormControl>\r\n              <Input\r\n                placeholder=\"Add User to group\"\r\n                mb={1}\r\n                onChange={(e) => handleSearch(e.target.value)}\r\n              />\r\n            </FormControl>\r\n\r\n            {loading ? (\r\n              <Spinner size=\"lg\" />\r\n            ) : (\r\n              searchResult?.map((user) => (\r\n                <UserListItem\r\n                  key={user._id}\r\n                  user={user}\r\n                  handleFunction={() => handleAddUser(user)}\r\n                />\r\n              ))\r\n            )}\r\n          </ModalBody>\r\n          <ModalFooter>\r\n            <Button onClick={() => handleRemove(user)} colorScheme=\"red\">\r\n              Leave Group\r\n            </Button>\r\n          </ModalFooter>\r\n        </ModalContent>\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default UpdateGroupChatModal;\r\n","import { FormControl } from \"@chakra-ui/form-control\";\r\nimport { Input } from \"@chakra-ui/input\";\r\nimport { Box, Text } from \"@chakra-ui/layout\";\r\nimport \"./styles.css\";\r\nimport { IconButton, Spinner, useToast } from \"@chakra-ui/react\";\r\nimport { getSender, getSenderFull } from \"../config/ChatLogics\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport axios from \"axios\";\r\nimport { ArrowBackIcon } from \"@chakra-ui/icons\";\r\nimport ProfileModal from \"./miscellaneous/ProfileModal\";\r\nimport ScrollableChat from \"./ScrollableChat\";\r\nimport Lottie from \"react-lottie\";\r\nimport animationData from \"../animations/typing.json\";\r\nimport Cookies from \"js-cookie\";\r\nimport io from \"socket.io-client\";\r\nimport UpdateGroupChatModal from \"./miscellaneous/UpdateGroupChatModal\";\r\nimport { ChatState } from \"../Context/ChatProvider\";\r\nimport \"./SingleChat.css\";\r\n\r\nconst ENDPOINT =\r\n  window.location.hostname === \"localhost\"\r\n    ? \"http://localhost:5001\"\r\n    : window.location.origin;\r\n\r\nlet socket;\r\nlet selectedChatCompare;\r\n\r\nconst arrayBufferFromBase64 = (b64) => {\r\n  const binary = atob(b64);\r\n  const bytes = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);\r\n  return bytes.buffer;\r\n};\r\n\r\nconst decryptStoredPrivateKey = async () => {\r\n  try {\r\n    const privateKeyJwkStr = sessionStorage.getItem(\"privateKeyJwk\");\r\n    if (!privateKeyJwkStr) {\r\n      console.warn(\"Nenhuma chave privada encontrada na sessÃ£o.\");\r\n      return;\r\n    }\r\n\r\n    const privateKeyJwk = JSON.parse(privateKeyJwkStr);\r\n\r\n    const privateKey = await window.crypto.subtle.importKey(\r\n      \"jwk\",\r\n      privateKeyJwk,\r\n      { name: \"RSA-OAEP\", hash: \"SHA-256\" },\r\n      true,\r\n      [\"decrypt\"]\r\n    );\r\n\r\n    console.log(\"âœ… Chave privada importada com sucesso da sessÃ£o.\");\r\n    return privateKey;\r\n  } catch (err) {\r\n    console.error(\"âŒ Erro ao importar chave privada:\", err);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst encryptMessageForUser = async (message, publicKeyPem) => {\r\n  console.log(\"1 - Iniciando criptografia para destinatÃ¡rio...\");\r\n  console.log(\"Chave publica do destinatÃ¡rio:\\n\", publicKeyPem);\r\n  const pemBody = publicKeyPem\r\n    .replace(\"-----BEGIN PUBLIC KEY-----\", \"\")\r\n    .replace(\"-----END PUBLIC KEY-----\", \"\")\r\n    .replace(/\\n/g, \"\");\r\n  const binaryDer = Uint8Array.from(atob(pemBody), (c) => c.charCodeAt(0));\r\n\r\n  const publicKey = await window.crypto.subtle.importKey(\r\n    \"spki\",\r\n    binaryDer.buffer,\r\n    { name: \"RSA-OAEP\", hash: \"SHA-256\" },\r\n    true,\r\n    [\"encrypt\"]\r\n  );\r\n\r\n  const encoded = new TextEncoder().encode(message);\r\n  const encrypted = await window.crypto.subtle.encrypt(\r\n    { name: \"RSA-OAEP\" },\r\n    publicKey,\r\n    encoded\r\n  );\r\n  const encryptedB64 = btoa(String.fromCharCode(...new Uint8Array(encrypted)));\r\n  console.log(\"âœ… Mensagem criptografada com sucesso.\");\r\n  return encryptedB64;\r\n};\r\n\r\nconst decryptMessage = async (encryptedB64, privateKey) => {\r\n  try {\r\n    console.log(\"Tentando descriptografar mensagem...\");\r\n    const encryptedBytes = new Uint8Array(arrayBufferFromBase64(encryptedB64));\r\n    const decrypted = await window.crypto.subtle.decrypt(\r\n      { name: \"RSA-OAEP\" },\r\n      privateKey,\r\n      encryptedBytes\r\n    );\r\n    const decoded = new TextDecoder().decode(decrypted);\r\n    console.log(\"âœ… Mensagem descriptografada:\", decoded);\r\n    return decoded;\r\n  } catch (err) {\r\n    console.warn(\"âš ï¸ Falha na descriptografia (mensagem nÃ£o destinada a este usuÃ¡rio).\");\r\n    return null;\r\n  }\r\n};\r\n\r\nconst SingleChat = ({ fetchAgain, setFetchAgain }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [socketConnected, setSocketConnected] = useState(false);\r\n  const [typing, setTyping] = useState(false);\r\n  const [istyping, setIsTyping] = useState(false);\r\n  const [privateKey, setPrivateKey] = useState(null);\r\n  const [socketInstance, setSocketInstance] = useState(null);\r\n\r\n  const toast = useToast();\r\n  const { selectedChat, setSelectedChat, user, notification, setNotification } = ChatState();\r\n\r\n  useEffect(() => {\r\n    if (!socketInstance) {\r\n      console.log(\"ðŸ”Œ Inicializando conexÃ£o socket...\");\r\n      const socketConn = io(ENDPOINT, {\r\n        transports: [\"websocket\"],\r\n        withCredentials: true,\r\n      });\r\n\r\n      socketConn.on(\"connect\", () => {\r\n        console.log(\"ðŸŸ¢ Conectado ao servidor Socket.IO\");\r\n        setSocketConnected(true);\r\n        socketConn.emit(\"setup\", user);\r\n      });\r\n\r\n      socketConn.on(\"disconnect\", () => {\r\n        console.warn(\"ðŸ”´ Desconectado do Socket.IO\");\r\n        setSocketConnected(false);\r\n      });\r\n\r\n      socketConn.on(\"typing\", () => setIsTyping(true));\r\n      socketConn.on(\"stop typing\", () => setIsTyping(false));\r\n\r\n      setSocketInstance(socketConn);\r\n    }\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const init = async () => {\r\n      const key = await decryptStoredPrivateKey();\r\n      if (mounted && key) setPrivateKey(key);\r\n\r\n      if (!socket) {\r\n        console.log(\"ðŸ”Œ Inicializando Socket.IO ->\", ENDPOINT);\r\n        socket = io(ENDPOINT, {\r\n          transports: [\"polling\", \"websocket\"],\r\n          withCredentials: true,\r\n        });\r\n\r\n        socket.on(\"connect\", () => {\r\n          console.log(\"ðŸŸ¢ Conectado ao servidor Socket.IO\");\r\n          setSocketConnected(true);\r\n        });\r\n\r\n        socket.on(\"disconnect\", () => {\r\n          console.warn(\"ðŸ”´ Desconectado do Socket.IO\");\r\n          setSocketConnected(false);\r\n        });\r\n\r\n        socket.on(\"connected\", () => setSocketConnected(true));\r\n        socket.on(\"typing\", () => setIsTyping(true));\r\n        socket.on(\"stop typing\", () => setIsTyping(false));\r\n      }\r\n\r\n      if (socket && user) {\r\n        socket.emit(\"setup\", user);\r\n      }\r\n    };\r\n\r\n    init();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [user]);\r\n\r\n  const fetchMessages = async (isRefresh = false) => {\r\n    if (!selectedChat || !privateKey) return;\r\n    console.log(isRefresh ? \"\\nðŸ”„ Atualizando mensagens...\" : \"\\n=== BUSCANDO MENSAGENS CIFRADAS ===\");\r\n\r\n    try {\r\n      const config = {\r\n        headers: { Authorization: `Bearer ${user.token}` },\r\n      };\r\n\r\n      const { data } = await axios.get(`/api/message/${selectedChat._id}`, config);\r\n      console.log(`ðŸ“¦ ${data.length} mensagens recebidas do servidor.`);\r\n\r\n      const decryptedMessages = [];\r\n      for (const msg of data) {\r\n        if (!msg.destinatario || (!msg.sender && !msg.chat)) continue;\r\n        if (\r\n          msg.destinatario?._id !== user._id &&\r\n          msg.sender?._id !== user._id\r\n        )\r\n          continue;\r\n\r\n        const clear = await decryptMessage(msg.content, privateKey);\r\n        decryptedMessages.push({\r\n          ...msg,\r\n          decrypted: clear || \"[Falha ao descriptografar mensagem]\",\r\n        });\r\n      }\r\n\r\n      setMessages(\r\n        decryptedMessages.filter(\r\n          (m) =>\r\n            !(\r\n              m.sender._id === user._id &&\r\n              (m.decrypted?.includes(\"Falha ao descriptografar\") ||\r\n                m.content?.includes(\"Falha ao descriptografar\"))\r\n            )\r\n        )\r\n      );\r\n\r\n      if (!isRefresh && socket && socketConnected) {\r\n        socket.emit(\"join chat\", selectedChat._id);\r\n      }\r\n\r\n      console.log(\"âœ… Todas as mensagens processadas e exibidas no chat.\");\r\n    } catch (error) {\r\n      console.error(\"âŒ Erro ao buscar mensagens:\", error);\r\n      toast({\r\n        title: \"Erro!\",\r\n        description: \"Falha ao carregar mensagens.\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (selectedChat && privateKey) {\r\n      fetchMessages(false);\r\n      selectedChatCompare = selectedChat;\r\n    }\r\n  }, [selectedChat, privateKey]);\r\n\r\n  useEffect(() => {\r\n    if (!socketInstance) return;\r\n    const handleIncoming = async (newMsg) => {\r\n      console.log(\"ðŸ’¬ Nova mensagem recebida via socket:\", newMsg);\r\n\r\n      if (!selectedChatCompare || selectedChatCompare._id !== newMsg.chat._id) {\r\n        if (!notification.find((n) => n._id === newMsg._id)) {\r\n          setNotification([newMsg, ...notification]);\r\n          setFetchAgain(!fetchAgain);\r\n        }\r\n        return;\r\n      }\r\n\r\n      const clear = await decryptMessage(newMsg.content, privateKey);\r\n      const finalMsg = { ...newMsg, decrypted: clear || \"[Falha ao descriptografar]\" };\r\n\r\n      setMessages((prev) => {\r\n        if (prev.some((m) => m._id === finalMsg._id)) return prev;\r\n        return [...prev, finalMsg];\r\n      });\r\n    };\r\n\r\n    socketInstance.on(\"message received\", handleIncoming);\r\n    socketInstance.on(\"refresh messages\", () => fetchMessages(true));\r\n\r\n    return () => {\r\n      socketInstance.off(\"message received\", handleIncoming);\r\n      socketInstance.off(\"refresh messages\");\r\n    };\r\n  }, [socketInstance, selectedChat, privateKey]);\r\n\r\n  const sendMessage = async (event) => {\r\n    const isEnter = event?.key === \"Enter\";\r\n    if (!isEnter && event?.type === \"click\" && !newMessage) return;\r\n\r\n    if ((isEnter || event?.type === \"click\") && newMessage) {\r\n      console.log(\"\\n=== INICIANDO ENVIO DE MENSAGEM CIFRADA ===\");\r\n\r\n      if (socket && socketConnected) {\r\n        socket.emit(\"stop typing\", selectedChat._id);\r\n      }\r\n\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-type\": \"application/json\",\r\n            Authorization: `Bearer ${user.token}`,\r\n          },\r\n        };\r\n\r\n        const { data: chatInfo } = await axios.get(\r\n          `/api/chat/${selectedChat._id}`,\r\n          config\r\n        );\r\n\r\n        const encryptedMessages = [];\r\n\r\n        for (const member of chatInfo.users) {\r\n          // â›” Evita enviar mensagem para si mesmo (remetente)\r\n          if (member._id === user._id) continue;\r\n\r\n          const encrypted = await encryptMessageForUser(newMessage, member.publicKey);\r\n          encryptedMessages.push({\r\n            destinatarioId: member._id,\r\n            content: encrypted,\r\n          });\r\n        }\r\n\r\n        const createdMessages = await Promise.all(\r\n          encryptedMessages.map(async (msg) => {\r\n            const { data } = await axios.post(\r\n              \"/api/message\",\r\n              {\r\n                content: msg.content,\r\n                chatId: selectedChat._id,\r\n                destinatarioId: msg.destinatarioId,\r\n              },\r\n              config\r\n            );\r\n            return data;\r\n          })\r\n        );\r\n\r\n        setNewMessage(\"\");\r\n        createdMessages.forEach((m) => socketInstance?.emit(\"new message\", m));\r\n\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          ...createdMessages\r\n            .filter((m) => !prev.some((p) => p._id === m._id))\r\n            .map((m) => ({ ...m, decrypted: newMessage })),\r\n        ]);\r\n      } catch (error) {\r\n        console.error(\"âŒ Erro ao enviar mensagem:\", error);\r\n        toast({\r\n          title: \"Erro!\",\r\n          description: \"Falha ao enviar mensagem.\",\r\n          status: \"error\",\r\n          duration: 5000,\r\n          isClosable: true,\r\n          position: \"bottom\",\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  const typingHandler = (e) => {\r\n    setNewMessage(e.target.value);\r\n    if (!socketConnected) return;\r\n    if (!typing) {\r\n      setTyping(true);\r\n      socket.emit(\"typing\", selectedChat._id);\r\n    }\r\n    let lastTypingTime = new Date().getTime();\r\n    var timerLength = 3000;\r\n    setTimeout(() => {\r\n      var timeNow = new Date().getTime();\r\n      if (timeNow - lastTypingTime >= timerLength && typing) {\r\n        socket.emit(\"stop typing\", selectedChat._id);\r\n        setTyping(false);\r\n      }\r\n    }, timerLength);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {selectedChat ? (\r\n        <div className=\"singlechat-container\">\r\n          <div className=\"chat-header\">\r\n            <div className=\"chat-header-left\">\r\n              <button className=\"back-button\" onClick={() => setSelectedChat(\"\")}>\r\n                <ArrowBackIcon />\r\n              </button>\r\n              <h2 className=\"chat-header-title\">\r\n                {!selectedChat.isGroupChat\r\n                  ? getSender(user, selectedChat.users)\r\n                  : selectedChat.chatName.toUpperCase()}\r\n              </h2>\r\n            </div>\r\n            <div className=\"chat-header-actions\">\r\n              {!selectedChat.isGroupChat ? (\r\n                <ProfileModal user={getSenderFull(user, selectedChat.users)}>\r\n                  <button className=\"header-icon-btn\">\r\n                    <i className=\"fas fa-info-circle\"></i>\r\n                  </button>\r\n                </ProfileModal>\r\n              ) : (\r\n                <UpdateGroupChatModal\r\n                  fetchMessages={fetchMessages}\r\n                  fetchAgain={fetchAgain}\r\n                  setFetchAgain={setFetchAgain}\r\n                >\r\n                  <button className=\"header-icon-btn\">\r\n                    <i className=\"fas fa-cog\"></i>\r\n                  </button>\r\n                </UpdateGroupChatModal>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"messages-container\">\r\n            {loading ? (\r\n              <div className=\"messages-loading\">\r\n                <Spinner size=\"xl\" color=\"#00a88e\" />\r\n              </div>\r\n            ) : (\r\n              <ScrollableChat messages={messages} />\r\n            )}\r\n            {istyping && (\r\n              <div className=\"typing-indicator\">\r\n                <div className=\"typing-dot\"></div>\r\n                <div className=\"typing-dot\"></div>\r\n                <div className=\"typing-dot\"></div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"message-input-container\">\r\n            <div className=\"message-input-wrapper\">\r\n              <input\r\n                className=\"message-input\"\r\n                placeholder=\"Enter a message...\"\r\n                value={newMessage}\r\n                onChange={typingHandler}\r\n                onKeyDown={sendMessage}\r\n              />\r\n              <button\r\n                className=\"send-button\"\r\n                onClick={(e) => sendMessage({ ...e, key: \"Enter\", type: \"click\" })}\r\n                disabled={!newMessage.trim()}\r\n              >\r\n                Send\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"empty-chat-state\">\r\n          <div className=\"empty-chat-icon\">ðŸ’¬</div>\r\n          <div className=\"empty-chat-text\">Click on a user to start chatting</div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SingleChat;\r\n","import { Box } from \"@chakra-ui/layout\";\r\nimport \"./styles.css\";\r\nimport SingleChat from \"./SingleChat\";\r\nimport { ChatState } from \"../Context/ChatProvider\";\r\nimport \"./Chatbox.css\";\r\n\r\nconst Chatbox = ({ fetchAgain, setFetchAgain }) => {\r\n  const { selectedChat } = ChatState();\r\n\r\n  return (\r\n    <div className=\"chatbox-container\">\r\n      {selectedChat ? (\r\n        <SingleChat fetchAgain={fetchAgain} setFetchAgain={setFetchAgain} />\r\n      ) : (\r\n        <div className=\"chatbox-empty\">\r\n          Click on a user to start chatting\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chatbox;\r\n","import { Stack } from \"@chakra-ui/layout\";\r\nimport { Skeleton } from \"@chakra-ui/skeleton\";\r\n\r\nconst ChatLoading = () => {\r\n  return (\r\n    <Stack>\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n      <Skeleton height=\"45px\" />\r\n    </Stack>\r\n  );\r\n};\r\n\r\nexport default ChatLoading;\r\n","import {\r\n  Modal,\r\n  ModalOverlay,\r\n  ModalContent,\r\n  ModalHeader,\r\n  ModalFooter,\r\n  ModalBody,\r\n  ModalCloseButton,\r\n  Button,\r\n  useDisclosure,\r\n  FormControl,\r\n  Input,\r\n  useToast,\r\n  Box,\r\n} from \"@chakra-ui/react\";\r\nimport axios from \"axios\";\r\nimport { useState } from \"react\";\r\nimport { ChatState } from \"../../Context/ChatProvider\";\r\nimport UserBadgeItem from \"../userAvatar/UserBadgeItem\";\r\nimport UserListItem from \"../userAvatar/UserListItem\";\r\n\r\nconst GroupChatModal = ({ children }) => {\r\n  const { isOpen, onOpen, onClose } = useDisclosure();\r\n  const [groupChatName, setGroupChatName] = useState();\r\n  const [selectedUsers, setSelectedUsers] = useState([]);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [searchResult, setSearchResult] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const toast = useToast();\r\n\r\n  const { user, chats, setChats } = ChatState();\r\n\r\n  const handleGroup = (userToAdd) => {\r\n    if (selectedUsers.includes(userToAdd)) {\r\n      toast({\r\n        title: \"User already added\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"top\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setSelectedUsers([...selectedUsers, userToAdd]);\r\n  };\r\n\r\n  const handleSearch = async (query) => {\r\n    setSearch(query);\r\n    if (!query) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.get(`/api/user?search=${search}`, config);\r\n      console.log(data);\r\n      setLoading(false);\r\n      setSearchResult(data);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occured!\",\r\n        description: \"Failed to Load the Search Results\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom-left\",\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleDelete = (delUser) => {\r\n    setSelectedUsers(selectedUsers.filter((sel) => sel._id !== delUser._id));\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!groupChatName || !selectedUsers) {\r\n      toast({\r\n        title: \"Please fill all the feilds\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"top\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.post(\r\n        `/api/chat/group`,\r\n        {\r\n          name: groupChatName,\r\n          users: JSON.stringify(selectedUsers.map((u) => u._id)),\r\n        },\r\n        config\r\n      );\r\n      setChats([data, ...chats]);\r\n      onClose();\r\n      toast({\r\n        title: \"New Group Chat Created!\",\r\n        status: \"success\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Failed to Create the Chat!\",\r\n        description: error.response.data,\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <span onClick={onOpen}>{children}</span>\r\n\r\n      <Modal onClose={onClose} isOpen={isOpen} isCentered>\r\n        <ModalOverlay />\r\n        <ModalContent>\r\n          <ModalHeader\r\n            fontSize=\"35px\"\r\n            fontFamily=\"Work sans\"\r\n            d=\"flex\"\r\n            justifyContent=\"center\"\r\n          >\r\n            Create Group Chat\r\n          </ModalHeader>\r\n          <ModalCloseButton />\r\n          <ModalBody d=\"flex\" flexDir=\"column\" alignItems=\"center\">\r\n            <FormControl>\r\n              <Input\r\n                placeholder=\"Chat Name\"\r\n                mb={3}\r\n                onChange={(e) => setGroupChatName(e.target.value)}\r\n              />\r\n            </FormControl>\r\n            <FormControl>\r\n              <Input\r\n                placeholder=\"Add Users eg: John, Piyush, Jane\"\r\n                mb={1}\r\n                onChange={(e) => handleSearch(e.target.value)}\r\n              />\r\n            </FormControl>\r\n            <Box w=\"100%\" d=\"flex\" flexWrap=\"wrap\">\r\n              {selectedUsers.map((u) => (\r\n                <UserBadgeItem\r\n                  key={u._id}\r\n                  user={u}\r\n                  handleFunction={() => handleDelete(u)}\r\n                />\r\n              ))}\r\n            </Box>\r\n            {loading ? (\r\n              // <ChatLoading />\r\n              <div>Loading...</div>\r\n            ) : (\r\n              searchResult\r\n                ?.slice(0, 4)\r\n                .map((user) => (\r\n                  <UserListItem\r\n                    key={user._id}\r\n                    user={user}\r\n                    handleFunction={() => handleGroup(user)}\r\n                  />\r\n                ))\r\n            )}\r\n          </ModalBody>\r\n          <ModalFooter>\r\n            <Button onClick={handleSubmit} colorScheme=\"blue\">\r\n              Create Chat\r\n            </Button>\r\n          </ModalFooter>\r\n        </ModalContent>\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default GroupChatModal;\r\n","import { AddIcon } from \"@chakra-ui/icons\";\r\nimport { useToast } from \"@chakra-ui/toast\";\r\nimport axios from \"axios\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { getSender } from \"../config/ChatLogics\";\r\nimport ChatLoading from \"./ChatLoading\";\r\nimport GroupChatModal from \"./miscellaneous/GroupChatModal\";\r\nimport { Avatar } from \"@chakra-ui/react\";\r\nimport { ChatState } from \"../Context/ChatProvider\";\r\nimport \"./MyChats.css\";\r\n\r\nconst MyChats = ({ fetchAgain }) => {\r\n  const [loggedUser, setLoggedUser] = useState();\r\n  const [availableUsers, setAvailableUsers] = useState([]);\r\n  const [loadingUsers, setLoadingUsers] = useState(false);\r\n  const [activeTab, setActiveTab] = useState(\"chats\"); // Adicionar estado para controlar a aba ativa\r\n\r\n  const { selectedChat, setSelectedChat, user, chats, setChats } = ChatState();\r\n\r\n  const toast = useToast();\r\n\r\n  const fetchChats = async () => {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n\r\n      const { data } = await axios.get(\"/api/chat\", config);\r\n      setChats(data);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occurred!\",\r\n        description: \"Failed to Load the chats\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom-left\",\r\n      });\r\n    }\r\n  };\r\n\r\n  const fetchAvailableUsers = async () => {\r\n    try {\r\n      setLoadingUsers(true);\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n\r\n      const { data } = await axios.get(\"/api/user\", config);\r\n      setAvailableUsers(data);\r\n      setLoadingUsers(false);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occurred!\",\r\n        description: \"Failed to Load available users\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom-left\",\r\n      });\r\n      setLoadingUsers(false);\r\n    }\r\n  };\r\n\r\n  const accessChat = async (userId) => {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          \"Content-type\": \"application/json\",\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.post(`/api/chat`, { userId }, config);\r\n\r\n      if (!chats.find((c) => c._id === data._id)) setChats([data, ...chats]);\r\n      setSelectedChat(data);\r\n\r\n      toast({\r\n        title: \"Chat Started!\",\r\n        status: \"success\",\r\n        duration: 3000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error fetching the chat\",\r\n        description: error.message,\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom-left\",\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    setLoggedUser(JSON.parse(localStorage.getItem(\"userInfo\")));\r\n    fetchChats();\r\n    fetchAvailableUsers();\r\n    // eslint-disable-next-line\r\n  }, [fetchAgain]);\r\n\r\n  return (\r\n    <div className=\"mychats-container\">\r\n      {/* Header */}\r\n      <div className=\"mychats-header\">\r\n        <h2 className=\"mychats-title\">My Chats</h2>\r\n        <GroupChatModal>\r\n          <button className=\"new-group-btn\">\r\n            <AddIcon />\r\n            <span>New Group</span>\r\n          </button>\r\n        </GroupChatModal>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"chats-tabs\">\r\n        <div className=\"tabs-list\">\r\n          <button\r\n            className={`tab-btn ${activeTab === \"chats\" ? \"active\" : \"\"}`}\r\n            onClick={() => setActiveTab(\"chats\")}\r\n          >\r\n            Chats ({chats ? chats.length : 0})\r\n          </button>\r\n          <button\r\n            className={`tab-btn ${activeTab === \"users\" ? \"active\" : \"\"}`}\r\n            onClick={() => setActiveTab(\"users\")}\r\n          >\r\n            Users ({availableUsers.length})\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Lista de Chats/UsuÃ¡rios */}\r\n      <div className=\"chats-list-container\">\r\n        {activeTab === \"chats\" ? (\r\n          // Aba de Chats\r\n          <>\r\n            {chats && chats.length > 0 ? (\r\n              chats.map((chat) => (\r\n                <div\r\n                  key={chat._id}\r\n                  className={`chat-item ${\r\n                    selectedChat === chat ? \"active\" : \"\"\r\n                  }`}\r\n                  onClick={() => setSelectedChat(chat)}\r\n                >\r\n                  <div className=\"chat-avatar\">\r\n                    {!chat.isGroupChat\r\n                      ? getSender(loggedUser, chat.users)?.[0]?.toUpperCase()\r\n                      : chat.chatName[0]?.toUpperCase()}\r\n                  </div>\r\n                  <div className=\"chat-info\">\r\n                    <div className=\"chat-name\">\r\n                      {!chat.isGroupChat\r\n                        ? getSender(loggedUser, chat.users)\r\n                        : chat.chatName}\r\n                    </div>\r\n                    {chat.latestMessage && (\r\n                      <div className=\"chat-last-message\">\r\n                        <b>{chat.latestMessage.sender.name}: </b>\r\n                        {chat.latestMessage.content.length > 40\r\n                          ? chat.latestMessage.content.substring(0, 41) + \"...\"\r\n                          : chat.latestMessage.content}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <div className=\"empty-state\">\r\n                No chats yet. Go to Users tab to start a conversation!\r\n              </div>\r\n            )}\r\n          </>\r\n        ) : (\r\n          // Aba de UsuÃ¡rios\r\n          <>\r\n            {loadingUsers ? (\r\n              <ChatLoading />\r\n            ) : availableUsers.length > 0 ? (\r\n              availableUsers.map((availableUser) => (\r\n                <div\r\n                  key={availableUser._id}\r\n                  className=\"chat-item\"\r\n                  onClick={() => accessChat(availableUser._id)}\r\n                >\r\n                  <Avatar\r\n                    size=\"sm\"\r\n                    name={availableUser.name}\r\n                    src={availableUser.pic}\r\n                    className=\"chat-avatar\"\r\n                  />\r\n                  <div className=\"chat-info\">\r\n                    <div className=\"chat-name\">{availableUser.name}</div>\r\n                    <div className=\"chat-last-message\">\r\n                      {availableUser.email}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <div className=\"empty-state\">No users available</div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MyChats;\r\n","import {\r\n  Modal,\r\n  ModalOverlay,\r\n  ModalContent,\r\n  ModalHeader,\r\n  ModalFooter,\r\n  ModalBody,\r\n  ModalCloseButton,\r\n  Button,\r\n  useDisclosure,\r\n  FormControl,\r\n  FormLabel,\r\n  Input,\r\n  useToast,\r\n  VStack,\r\n  Avatar,\r\n  Text,\r\n  Box,\r\n  InputGroup,\r\n  InputRightElement,\r\n  AlertDialog,\r\n  AlertDialogBody,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogContent,\r\n  AlertDialogOverlay,\r\n} from \"@chakra-ui/react\";\r\nimport { useState, useRef } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { ChatState } from \"../../Context/ChatProvider\";\r\nimport \"./UserProfileModal.css\";\r\n\r\nconst UserProfileModal = ({ children }) => {\r\n  const { isOpen, onOpen, onClose } = useDisclosure();\r\n  const [isDeleteOpen, setIsDeleteOpen] = useState(false);\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const cancelRef = useRef();\r\n  const toast = useToast();\r\n  const history = useHistory();\r\n  const { user, setUser } = ChatState();\r\n\r\n  const [name, setName] = useState(user.name);\r\n  const [email, setEmail] = useState(user.email);\r\n  const [password, setPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n  const [pic, setPic] = useState(user.pic);\r\n  const [loading, setLoading] = useState(false);\r\n  const [show, setShow] = useState(false);\r\n\r\n  const handleClick = () => setShow(!show);\r\n\r\n  const postDetails = (pics) => {\r\n    setLoading(true);\r\n    if (pics === undefined) {\r\n      toast({\r\n        title: \"Please Select an Image!\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (pics.type === \"image/jpeg\" || pics.type === \"image/png\") {\r\n      const data = new FormData();\r\n      data.append(\"file\", pics);\r\n      data.append(\"upload_preset\", \"chat-app\");\r\n      data.append(\"cloud_name\", \"piyushproj\");\r\n      fetch(\"https://api.cloudinary.com/v1_1/piyushproj/image/upload\", {\r\n        method: \"post\",\r\n        body: data,\r\n      })\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          setPic(data.url.toString());\r\n          setLoading(false);\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n          setLoading(false);\r\n        });\r\n    } else {\r\n      toast({\r\n        title: \"Please Select an Image!\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const submitHandler = async () => {\r\n    if (password && password !== confirmPassword) {\r\n      toast({\r\n        title: \"Passwords Do Not Match\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const config = {\r\n        headers: {\r\n          \"Content-type\": \"application/json\",\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n\r\n      const updateData = {\r\n        name,\r\n        email,\r\n        pic,\r\n      };\r\n\r\n      if (password) {\r\n        updateData.password = password;\r\n      }\r\n\r\n      const { data } = await axios.put(\"/api/user/profile\", updateData, config);\r\n\r\n      toast({\r\n        title: \"Profile Updated Successfully\",\r\n        status: \"success\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n\r\n      setUser(data);\r\n      localStorage.setItem(\"userInfo\", JSON.stringify(data));\r\n\r\n      if (user.name !== data.name) {\r\n        const oldPrivateKey = localStorage.getItem(`${user.name}_privateKey`);\r\n        if (oldPrivateKey) {\r\n          localStorage.setItem(`${data.name}_privateKey`, oldPrivateKey);\r\n          localStorage.removeItem(`${user.name}_privateKey`);\r\n        }\r\n      }\r\n\r\n      setLoading(false);\r\n      setIsEditing(false);\r\n      setPassword(\"\");\r\n      setConfirmPassword(\"\");\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occurred!\",\r\n        description:\r\n          error.response?.data?.message || \"Failed to update profile\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const deleteHandler = async () => {\r\n    try {\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n\r\n      await axios.delete(\"/api/user/profile\", config);\r\n\r\n      toast({\r\n        title: \"Account Deleted Successfully\",\r\n        status: \"success\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n\r\n      localStorage.removeItem(\"userInfo\");\r\n      localStorage.removeItem(`${user.name}_privateKey`);\r\n\r\n      history.push(\"/\");\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occurred!\",\r\n        description:\r\n          error.response?.data?.message || \"Failed to delete account\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom\",\r\n      });\r\n    }\r\n  };\r\n\r\n  const onDeleteClose = () => setIsDeleteOpen(false);\r\n\r\n  return (\r\n    <>\r\n      <span onClick={onOpen}>{children}</span>\r\n\r\n      <Modal size=\"lg\" onClose={onClose} isOpen={isOpen} isCentered>\r\n        <ModalOverlay className=\"profile-modal-overlay\" />\r\n        <ModalContent className=\"profile-modal-content\">\r\n          <ModalHeader className=\"profile-modal-header\">My Profile</ModalHeader>\r\n          <ModalCloseButton className=\"profile-modal-close\" />\r\n          <ModalBody className=\"profile-modal-body\">\r\n            {!isEditing ? (\r\n              // View Mode\r\n              <VStack spacing={6} className=\"profile-view-container\">\r\n                <Avatar\r\n                  size=\"2xl\"\r\n                  name={user.name}\r\n                  src={user.pic}\r\n                  className=\"profile-avatar-large\"\r\n                />\r\n                <Box textAlign=\"center\" className=\"profile-info\">\r\n                  <Text className=\"profile-name\">{user.name}</Text>\r\n                  <Text className=\"profile-email\">{user.email}</Text>\r\n                </Box>\r\n                <VStack spacing={3} w=\"100%\">\r\n                  <Button\r\n                    className=\"profile-action-btn btn-edit\"\r\n                    onClick={() => setIsEditing(true)}\r\n                    w=\"100%\"\r\n                  >\r\n                    Edit Profile\r\n                  </Button>\r\n                  <Button\r\n                    className=\"profile-action-btn btn-delete\"\r\n                    onClick={() => setIsDeleteOpen(true)}\r\n                    w=\"100%\"\r\n                  >\r\n                    Delete Account\r\n                  </Button>\r\n                </VStack>\r\n              </VStack>\r\n            ) : (\r\n              // Edit Mode\r\n              <VStack spacing={4} className=\"profile-edit-container\">\r\n                <Avatar\r\n                  size=\"xl\"\r\n                  name={name}\r\n                  src={pic}\r\n                  className=\"profile-avatar-medium\"\r\n                />\r\n\r\n                <FormControl className=\"form-control-profile\">\r\n                  <FormLabel className=\"form-label-profile\">Name</FormLabel>\r\n                  <Input\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    className=\"form-input-profile\"\r\n                  />\r\n                </FormControl>\r\n\r\n                <FormControl className=\"form-control-profile\">\r\n                  <FormLabel className=\"form-label-profile\">Email</FormLabel>\r\n                  <Input\r\n                    type=\"email\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    className=\"form-input-profile\"\r\n                  />\r\n                </FormControl>\r\n\r\n                <FormControl className=\"form-control-profile\">\r\n                  <FormLabel className=\"form-label-profile\">\r\n                    New Password (leave blank to keep current)\r\n                  </FormLabel>\r\n                  <InputGroup className=\"input-group-profile\">\r\n                    <Input\r\n                      type={show ? \"text\" : \"password\"}\r\n                      value={password}\r\n                      onChange={(e) => setPassword(e.target.value)}\r\n                      placeholder=\"Enter new password\"\r\n                      className=\"form-input-profile\"\r\n                    />\r\n                    <InputRightElement className=\"input-right-element-profile\">\r\n                      <Button\r\n                        h=\"1.75rem\"\r\n                        size=\"sm\"\r\n                        onClick={handleClick}\r\n                        className=\"show-password-profile\"\r\n                      >\r\n                        {show ? \"Hide\" : \"Show\"}\r\n                      </Button>\r\n                    </InputRightElement>\r\n                  </InputGroup>\r\n                </FormControl>\r\n\r\n                {password && (\r\n                  <FormControl className=\"form-control-profile\">\r\n                    <FormLabel className=\"form-label-profile\">\r\n                      Confirm New Password\r\n                    </FormLabel>\r\n                    <InputGroup className=\"input-group-profile\">\r\n                      <Input\r\n                        type={show ? \"text\" : \"password\"}\r\n                        value={confirmPassword}\r\n                        onChange={(e) => setConfirmPassword(e.target.value)}\r\n                        placeholder=\"Confirm new password\"\r\n                        className=\"form-input-profile\"\r\n                      />\r\n                      <InputRightElement className=\"input-right-element-profile\">\r\n                        <Button\r\n                          h=\"1.75rem\"\r\n                          size=\"sm\"\r\n                          onClick={handleClick}\r\n                          className=\"show-password-profile\"\r\n                        >\r\n                          {show ? \"Hide\" : \"Show\"}\r\n                        </Button>\r\n                      </InputRightElement>\r\n                    </InputGroup>\r\n                  </FormControl>\r\n                )}\r\n\r\n                <FormControl className=\"form-control-profile\">\r\n                  <FormLabel className=\"form-label-profile\">\r\n                    Update Profile Picture\r\n                  </FormLabel>\r\n                  <Input\r\n                    type=\"file\"\r\n                    p={1.5}\r\n                    accept=\"image/*\"\r\n                    onChange={(e) => postDetails(e.target.files[0])}\r\n                    className=\"file-input-profile\"\r\n                  />\r\n                </FormControl>\r\n\r\n                <VStack spacing={3} w=\"100%\">\r\n                  <Button\r\n                    className=\"profile-action-btn btn-save\"\r\n                    onClick={submitHandler}\r\n                    isLoading={loading}\r\n                    w=\"100%\"\r\n                  >\r\n                    Save Changes\r\n                  </Button>\r\n                  <Button\r\n                    className=\"profile-action-btn btn-cancel\"\r\n                    onClick={() => {\r\n                      setIsEditing(false);\r\n                      setName(user.name);\r\n                      setEmail(user.email);\r\n                      setPic(user.pic);\r\n                      setPassword(\"\");\r\n                      setConfirmPassword(\"\");\r\n                    }}\r\n                    w=\"100%\"\r\n                  >\r\n                    Cancel\r\n                  </Button>\r\n                </VStack>\r\n              </VStack>\r\n            )}\r\n          </ModalBody>\r\n          <ModalFooter className=\"profile-modal-footer\">\r\n            <Button onClick={onClose} className=\"btn-close-modal\">\r\n              Close\r\n            </Button>\r\n          </ModalFooter>\r\n        </ModalContent>\r\n      </Modal>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <AlertDialog\r\n        isOpen={isDeleteOpen}\r\n        leastDestructiveRef={cancelRef}\r\n        onClose={onDeleteClose}\r\n      >\r\n        <AlertDialogOverlay className=\"alert-dialog-overlay\">\r\n          <AlertDialogContent className=\"alert-dialog-content\">\r\n            <AlertDialogHeader className=\"alert-dialog-header\">\r\n              Delete Account\r\n            </AlertDialogHeader>\r\n\r\n            <AlertDialogBody className=\"alert-dialog-body\">\r\n              Are you sure you want to delete your account? This action cannot\r\n              be undone. All your chats and messages will be permanently\r\n              deleted.\r\n            </AlertDialogBody>\r\n\r\n            <AlertDialogFooter className=\"alert-dialog-footer\">\r\n              <Button\r\n                ref={cancelRef}\r\n                onClick={onDeleteClose}\r\n                className=\"btn-alert-cancel\"\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                onClick={deleteHandler}\r\n                className=\"btn-alert-delete\"\r\n                ml={3}\r\n              >\r\n                Delete\r\n              </Button>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialogOverlay>\r\n      </AlertDialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default UserProfileModal;\r\n","import { useDisclosure } from \"@chakra-ui/hooks\";\r\nimport { Input } from \"@chakra-ui/input\";\r\nimport {\r\n  Menu,\r\n  MenuButton,\r\n  MenuDivider,\r\n  MenuItem,\r\n  MenuList,\r\n} from \"@chakra-ui/menu\";\r\nimport {\r\n  Drawer,\r\n  DrawerBody,\r\n  DrawerContent,\r\n  DrawerHeader,\r\n  DrawerOverlay,\r\n} from \"@chakra-ui/modal\";\r\nimport { Tooltip } from \"@chakra-ui/tooltip\";\r\nimport { BellIcon, ChevronDownIcon } from \"@chakra-ui/icons\";\r\nimport { Avatar } from \"@chakra-ui/avatar\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useToast } from \"@chakra-ui/toast\";\r\nimport ChatLoading from \"../ChatLoading\";\r\nimport { Spinner } from \"@chakra-ui/spinner\";\r\nimport NotificationBadge from \"react-notification-badge\";\r\nimport { Effect } from \"react-notification-badge\";\r\nimport { getSender } from \"../../config/ChatLogics\";\r\nimport UserListItem from \"../userAvatar/UserListItem\";\r\nimport { ChatState } from \"../../Context/ChatProvider\";\r\nimport UserProfileModal from \"./UserProfileModal\";\r\nimport \"./SideDrawer.css\";\r\n\r\nfunction SideDrawer() {\r\n  const [search, setSearch] = useState(\"\");\r\n  const [searchResult, setSearchResult] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingChat, setLoadingChat] = useState(false);\r\n\r\n  const {\r\n    setSelectedChat,\r\n    user,\r\n    notification,\r\n    setNotification,\r\n    chats,\r\n    setChats,\r\n  } = ChatState();\r\n\r\n  const toast = useToast();\r\n  const { isOpen, onOpen, onClose } = useDisclosure();\r\n  const history = useHistory();\r\n\r\n  const logoutHandler = () => {\r\n    localStorage.removeItem(\"userInfo\");\r\n    history.push(\"/\");\r\n  };\r\n\r\n  const handleSearch = async () => {\r\n    if (!search) {\r\n      toast({\r\n        title: \"Please Enter something in search\",\r\n        status: \"warning\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"top-left\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n\r\n      const { data } = await axios.get(`/api/user?search=${search}`, config);\r\n\r\n      setLoading(false);\r\n      setSearchResult(data);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error Occurred!\",\r\n        description: \"Failed to Load the Search Results\",\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom-left\",\r\n      });\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const accessChat = async (userId) => {\r\n    try {\r\n      setLoadingChat(true);\r\n      const config = {\r\n        headers: {\r\n          \"Content-type\": \"application/json\",\r\n          Authorization: `Bearer ${user.token}`,\r\n        },\r\n      };\r\n      const { data } = await axios.post(`/api/chat`, { userId }, config);\r\n\r\n      if (!chats.find((c) => c._id === data._id)) setChats([data, ...chats]);\r\n      setSelectedChat(data);\r\n      setLoadingChat(false);\r\n      onClose();\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error fetching the chat\",\r\n        description: error.message,\r\n        status: \"error\",\r\n        duration: 5000,\r\n        isClosable: true,\r\n        position: \"bottom-left\",\r\n      });\r\n      setLoadingChat(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"sidedrawer-container\">\r\n        <Tooltip label=\"Search Users to chat\" hasArrow placement=\"bottom-end\">\r\n          <button className=\"search-button\" onClick={onOpen}>\r\n            <i className=\"fas fa-search\"></i>\r\n            <span>Search User</span>\r\n          </button>\r\n        </Tooltip>\r\n\r\n        <h1 className=\"app-title\">CryptoChat</h1>\r\n\r\n        <div className=\"header-actions\">\r\n          <Menu>\r\n            <MenuButton className=\"notification-btn\">\r\n              <NotificationBadge\r\n                count={notification.length}\r\n                effect={Effect.SCALE}\r\n              />\r\n              <BellIcon className=\"bell-icon\" />\r\n            </MenuButton>\r\n            <MenuList className=\"dropdown-menu\" pl={2}>\r\n              {!notification.length && (\r\n                <MenuItem className=\"dropdown-item\">No New Messages</MenuItem>\r\n              )}\r\n              {notification.map((notif) => (\r\n                <MenuItem\r\n                  key={notif._id}\r\n                  className=\"dropdown-item\"\r\n                  onClick={() => {\r\n                    setSelectedChat(notif.chat);\r\n                    setNotification(notification.filter((n) => n !== notif));\r\n                  }}\r\n                >\r\n                  {notif.chat.isGroupChat\r\n                    ? `New Message in ${notif.chat.chatName}`\r\n                    : `New Message from ${getSender(user, notif.chat.users)}`}\r\n                </MenuItem>\r\n              ))}\r\n            </MenuList>\r\n          </Menu>\r\n\r\n          <Menu>\r\n            <MenuButton className=\"user-menu-btn\">\r\n              <Avatar\r\n                size=\"sm\"\r\n                cursor=\"pointer\"\r\n                name={user.name}\r\n                src={user.pic}\r\n              />\r\n              <ChevronDownIcon className=\"chevron-icon\" />\r\n            </MenuButton>\r\n            <MenuList className=\"dropdown-menu\">\r\n              <UserProfileModal>\r\n                <MenuItem className=\"dropdown-item\">My Profile</MenuItem>\r\n              </UserProfileModal>\r\n              <MenuDivider />\r\n              <MenuItem className=\"dropdown-item\" onClick={logoutHandler}>\r\n                Logout\r\n              </MenuItem>\r\n            </MenuList>\r\n          </Menu>\r\n        </div>\r\n      </div>\r\n\r\n      <Drawer placement=\"left\" onClose={onClose} isOpen={isOpen}>\r\n        <DrawerOverlay />\r\n        <DrawerContent className=\"search-drawer\">\r\n          <DrawerHeader className=\"search-drawer-header\">\r\n            Search Users\r\n          </DrawerHeader>\r\n          <DrawerBody>\r\n            <div className=\"search-input-container\">\r\n              <input\r\n                className=\"search-input\"\r\n                placeholder=\"Search by name or email\"\r\n                value={search}\r\n                onChange={(e) => setSearch(e.target.value)}\r\n              />\r\n              <button className=\"search-go-btn\" onClick={handleSearch}>\r\n                Go\r\n              </button>\r\n            </div>\r\n            {loading ? (\r\n              <ChatLoading />\r\n            ) : (\r\n              searchResult?.map((user) => (\r\n                <UserListItem\r\n                  key={user._id}\r\n                  user={user}\r\n                  handleFunction={() => accessChat(user._id)}\r\n                />\r\n              ))\r\n            )}\r\n            {loadingChat && <Spinner ml=\"auto\" d=\"flex\" color=\"#00a88e\" />}\r\n          </DrawerBody>\r\n        </DrawerContent>\r\n      </Drawer>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default SideDrawer;\r\n","import { useState } from \"react\";\r\nimport Chatbox from \"../components/Chatbox\";\r\nimport MyChats from \"../components/MyChats\";\r\nimport SideDrawer from \"../components/miscellaneous/SideDrawer\";\r\nimport { ChatState } from \"../Context/ChatProvider\";\r\nimport \"./ChatPage.css\";\r\n\r\nconst Chatpage = () => {\r\n  const [fetchAgain, setFetchAgain] = useState(false);\r\n  const { user } = ChatState();\r\n\r\n  return (\r\n    <div className=\"chatpage-container\">\r\n      {user && <SideDrawer />}\r\n      <div className=\"chat-content\">\r\n        {user && <MyChats fetchAgain={fetchAgain} />}\r\n        {user && (\r\n          <Chatbox fetchAgain={fetchAgain} setFetchAgain={setFetchAgain} />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chatpage;","import \"./App.css\";\r\nimport Homepage from \"./Pages/Homepage\";\r\nimport { Route } from \"react-router-dom\";\r\nimport Chatpage from \"./Pages/Chatpage\";\r\nimport \"./chakra-override.css\";\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <Route path=\"/\" component={Homepage} exact />\r\n      <Route path=\"/chats\" component={Chatpage} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\nimport { ChakraProvider, extendTheme } from \"@chakra-ui/react\";\r\nimport ChatProvider from \"./Context/ChatProvider\";\r\nimport { BrowserRouter } from \"react-router-dom\";\r\nimport \"./chakra-override.css\";\r\n\r\n// Tema customizado com cores escuras e z-index corrigido\r\nconst theme = extendTheme({\r\n  colors: {\r\n    brand: {\r\n      50: \"#e6f7f5\",\r\n      100: \"#b3e8e0\",\r\n      200: \"#80d9cb\",\r\n      300: \"#4dcab6\",\r\n      400: \"#1abba1\",\r\n      500: \"#00a88e\",\r\n      600: \"#008a73\",\r\n      700: \"#006b58\",\r\n      800: \"#004d3e\",\r\n      900: \"#002e23\",\r\n    },\r\n    navy: {\r\n      50: \"#e8eaf6\",\r\n      100: \"#c5cbe9\",\r\n      200: \"#a1abdc\",\r\n      300: \"#7e8ccf\",\r\n      400: \"#5a6dc2\",\r\n      500: \"#374ea8\",\r\n      600: \"#2d3e86\",\r\n      700: \"#232f65\",\r\n      800: \"#192044\",\r\n      900: \"#0f1123\",\r\n    },\r\n  },\r\n  config: {\r\n    initialColorMode: \"dark\",\r\n    useSystemColorMode: false,\r\n  },\r\n  styles: {\r\n    global: {\r\n      body: {\r\n        bg: \"navy.900\",\r\n        color: \"white\",\r\n      },\r\n    },\r\n  },\r\n  // IMPORTANTE: Definir z-index para os componentes\r\n  zIndices: {\r\n    hide: -1,\r\n    auto: \"auto\",\r\n    base: 0,\r\n    docked: 10,\r\n    dropdown: 1000,\r\n    sticky: 1100,\r\n    banner: 1200,\r\n    overlay: 1300,\r\n    modal: 1400,\r\n    popover: 1500,\r\n    skipLink: 1600,\r\n    toast: 1700,\r\n    tooltip: 1800,\r\n  },\r\n});\r\n\r\nReactDOM.render(\r\n  <ChakraProvider theme={theme}>\r\n    <BrowserRouter>\r\n      <ChatProvider>\r\n        <App />\r\n      </ChatProvider>\r\n    </BrowserRouter>\r\n  </ChakraProvider>,\r\n  document.getElementById(\"root\")\r\n);\r\n\r\nreportWebVitals();\r\n"],"sourceRoot":""}