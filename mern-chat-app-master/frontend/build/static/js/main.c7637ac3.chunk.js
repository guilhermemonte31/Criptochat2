(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{153:function(e,t,a){},154:function(e,t,a){},180:function(e,t,a){},211:function(e,t,a){},212:function(e,t,a){},236:function(e,t,a){},287:function(e){e.exports=JSON.parse("{}")},308:function(e,t,a){},309:function(e,t,a){},310:function(e,t,a){},313:function(e,t,a){},314:function(e,t,a){},315:function(e,t,a){"use strict";a.r(t);var s=a(0),c=a(42),o=a.n(c),n=(a(211),a(212),a(9)),i=a(25),r=a(10),l=a.n(r),d=a(358),j=a(1);const b=Object(s.createContext)(),h=()=>Object(s.useContext)(b);var p=e=>{let{children:t}=e;const[a,c]=Object(s.useState)(),[o,i]=Object(s.useState)(),[r,l]=Object(s.useState)([]),[d,h]=Object(s.useState)(),p=Object(n.e)();return Object(s.useEffect)((()=>{const e=JSON.parse(localStorage.getItem("userInfo")||"null");i(e),e||(console.log("No user info found, redirecting to homepage"),p.push("/"))}),[p]),Object(j.jsx)(b.Provider,{value:{selectedChat:a,setSelectedChat:c,user:o,setUser:i,notification:r,setNotification:l,chats:d,setChats:h},children:t})};async function u(e,t){const a=Uint8Array.from(atob(e.salt),(e=>e.charCodeAt(0))),s=Uint8Array.from(atob(e.iv),(e=>e.charCodeAt(0))),c=Uint8Array.from(atob(e.cipher),(e=>e.charCodeAt(0))),o=await async function(e,t){const a=new TextEncoder,s=await crypto.subtle.importKey("raw",a.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["decrypt"])}(t,a);let n;try{n=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},o,c)}catch(i){throw console.error("Decryption failed:",i),i}return await crypto.subtle.importKey("pkcs8",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}var m=()=>{const[e,t]=Object(s.useState)(!1),a=Object(d.a)(),[c,o]=Object(s.useState)(),[r,b]=Object(s.useState)(),[p,m]=Object(s.useState)(!1),O=Object(n.e)(),{setUser:g}=h();return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{className:"form-label",children:"Email Address *"}),Object(j.jsx)("input",{className:"form-input",type:"email",placeholder:"Enter Your Email Address",value:c,onChange:e=>o(e.target.value)})]}),Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{className:"form-label",children:"Password *"}),Object(j.jsxs)("div",{className:"input-with-button",children:[Object(j.jsx)("input",{className:"form-input",type:e?"text":"password",placeholder:"Enter password",value:r,onChange:e=>b(e.target.value)}),Object(j.jsx)("button",{className:"show-password-btn",onClick:()=>t(!e),type:"button",children:e?"Hide":"Show"})]})]}),Object(j.jsxs)("button",{className:"btn btn-primary",onClick:async()=>{if(m(!0),!c||!r)return a({title:"Please Fill all the Feilds",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),void m(!1);try{const e={headers:{"Content-type":"application/json"}},{data:t}=await l.a.post("/api/user/login",{email:c,password:r},e),o=localStorage.getItem("".concat(t.name,"_privateKey"));if(!o)return a({title:"Private Key Not Found",description:"Please sign up again to generate encryption keys.",status:"error",duration:8e3,isClosable:!0,position:"bottom"}),void m(!1);const n=JSON.parse(o);let d;try{d=await u(n,r);const e=await crypto.subtle.exportKey("jwk",d);sessionStorage.setItem("privateKeyJwk",JSON.stringify(e)),console.log("\ud83d\udcbe Chave privada armazenada no sessionStorage.")}catch(s){return console.error("Decryption failed:",s),a({description:"Falha ao descriptografar: ".concat(s.message),status:"error",duration:7e3,isClosable:!0,position:"bottom"}),void m(!1)}if(t.publicKey){const e=await crypto.subtle.importKey("spki",Uint8Array.from(atob(t.publicKey),(e=>e.charCodeAt(0))),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]);g(Object(i.a)(Object(i.a)({},t),{},{privateKey:d,publicKey:e}))}a({title:"Login Successful",status:"success",duration:5e3,isClosable:!0,position:"bottom"}),g(Object(i.a)(Object(i.a)({},t),{},{privateKey:d})),localStorage.setItem("userInfo",JSON.stringify(t)),m(!1),O.push("/chats")}catch(o){var e,t;a({title:"Error Occurred!",description:(null===(e=o.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Login failed",status:"error",duration:5e3,isClosable:!0,position:"bottom"}),m(!1)}},disabled:p,children:[p&&Object(j.jsx)("span",{className:"spinner"}),"Login"]})]})};var O=()=>{const[e,t]=Object(s.useState)(!1),a=()=>t(!e),c=Object(d.a)(),o=Object(n.e)(),[i,r]=Object(s.useState)(""),[b,h]=Object(s.useState)(""),[p,u]=Object(s.useState)(),[m,O]=Object(s.useState)(),[g,x]=Object(s.useState)(""),[f,v]=Object(s.useState)(""),[y,N]=Object(s.useState)(),[C,w]=Object(s.useState)(!1),S=e=>{const t=new Uint8Array(e);let a="";for(let s=0;s<t.byteLength;s++)a+=String.fromCharCode(t[s]);return btoa(a)},A=async(e,t)=>{const a=window.crypto.getRandomValues(new Uint8Array(16)),s=window.crypto.getRandomValues(new Uint8Array(12)),c=await(async(e,t)=>{const a=new TextEncoder,s=await window.crypto.subtle.importKey("raw",a.encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])})(t,a),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},c,e);return{cipher:S(o),iv:S(s.buffer),salt:S(a.buffer)}};return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{className:"form-label",children:"Name *"}),Object(j.jsx)("input",{className:"form-input",placeholder:"Enter Your Name",value:i,onChange:e=>r(e.target.value)})]}),Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{className:"form-label",children:"Email Address *"}),Object(j.jsx)("input",{className:"form-input",type:"email",placeholder:"Enter Your Email Address",value:b,onChange:e=>h(e.target.value)})]}),Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{className:"form-label",children:"Password *"}),Object(j.jsxs)("div",{className:"input-with-button",children:[Object(j.jsx)("input",{className:"form-input",type:e?"text":"password",placeholder:"Enter Password",value:f,onChange:e=>v(e.target.value)}),Object(j.jsx)("button",{className:"show-password-btn",onClick:a,type:"button",children:e?"Hide":"Show"})]})]}),Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{className:"form-label",children:"Confirm Password *"}),Object(j.jsxs)("div",{className:"input-with-button",children:[Object(j.jsx)("input",{className:"form-input",type:e?"text":"password",placeholder:"Confirm password",value:g,onChange:e=>x(e.target.value)}),Object(j.jsx)("button",{className:"show-password-btn",onClick:a,type:"button",children:e?"Hide":"Show"})]})]}),Object(j.jsxs)("div",{className:"form-group",children:[Object(j.jsx)("label",{className:"form-label",children:"Upload your Picture"}),Object(j.jsxs)("div",{className:"file-input-wrapper",children:[Object(j.jsx)("input",{type:"file",id:"pic-upload",accept:"image/*",onChange:e=>(e=>{if(w(!0),void 0!==e){if(console.log(e),"image/jpeg"!==e.type&&"image/png"!==e.type)return c({title:"Please Select an Image!",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),void w(!1);{const t=new FormData;t.append("file",e),t.append("upload_preset","chat-app"),t.append("cloud_name","piyushproj"),fetch("https://api.cloudinary.com/v1_1/piyushproj/image/upload",{method:"post",body:t}).then((e=>e.json())).then((e=>{N(e.url.toString()),console.log(e.url.toString()),w(!1)})).catch((e=>{console.log(e),w(!1)}))}}else c({title:"Please Select an Image!",status:"warning",duration:5e3,isClosable:!0,position:"bottom"})})(e.target.files[0])}),Object(j.jsx)("label",{htmlFor:"pic-upload",className:"file-input-label",children:y?"Image Selected \u2713":"Choose File"})]})]}),Object(j.jsxs)("button",{className:"btn btn-signup",onClick:async()=>{if(w(!0),!i||!b||!f||!g)return c({title:"Please Fill all the Feilds",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),void w(!1);if(f===g){console.log(i,b,f,y);try{const e=await window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["encrypt","decrypt"]),t=await window.crypto.subtle.exportKey("spki",e.publicKey),a=S(t),s="-----BEGIN PUBLIC KEY-----\n".concat(a.match(/.{1,64}/g).join("\n"),"\n-----END PUBLIC KEY-----"),n=await window.crypto.subtle.exportKey("pkcs8",e.privateKey),r=S(n),d="-----BEGIN PRIVATE KEY-----\n".concat(r.match(/.{1,64}/g).join("\n"),"\n-----END PRIVATE KEY-----");console.log("=== PUBLIC KEY (PEM) ===\n",s),console.log("=== PRIVATE KEY (PEM) ===\n",d);const j=await(async e=>{const t=await window.crypto.subtle.exportKey("spki",e),a=S(t);return"-----BEGIN PUBLIC KEY-----\n".concat(a.match(/.{1,64}/g).join("\n"),"\n-----END PUBLIC KEY-----")})(e.publicKey),h=await(async e=>await window.crypto.subtle.exportKey("pkcs8",e))(e.privateKey),p=await A(h,f),u={headers:{"Content-type":"application/json"}},{data:m}=await l.a.post("/api/user",{name:i,email:b,password:f,pic:y,publicKey:j},u);!function(e){for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a.endsWith("_privateKey")&&a!=="".concat(e,"_privateKey")&&(localStorage.removeItem(a),t--)}}(i),localStorage.setItem("".concat(i,"_privateKey"),JSON.stringify(p)),localStorage.setItem("userInfo",JSON.stringify(m)),console.log(m),c({title:"Registration Successful",status:"success",duration:5e3,isClosable:!0,position:"bottom"}),w(!1),o.push("/chats")}catch(e){c({title:"Error Occured!",description:e.response.data.message,status:"error",duration:5e3,isClosable:!0,position:"bottom"}),w(!1)}}else c({title:"Passwords Do Not Match",status:"warning",duration:5e3,isClosable:!0,position:"bottom"})},disabled:C,children:[C&&Object(j.jsx)("span",{className:"spinner"}),"Sign Up"]})]})};a(236);var g=function(){const e=Object(n.e)(),[t,a]=Object(s.useState)("login");return Object(s.useEffect)((()=>{JSON.parse(localStorage.getItem("userInfo")||"null")&&e.push("/chats")}),[e]),Object(j.jsx)("div",{className:"homepage-container",children:Object(j.jsxs)("div",{className:"login-card",children:[Object(j.jsx)("h1",{className:"login-title",children:"CriptoChat 2.0"}),Object(j.jsxs)("div",{className:"tabs-container",children:[Object(j.jsx)("button",{className:"tab-button ".concat("login"===t?"active":""),onClick:()=>a("login"),children:"Login"}),Object(j.jsx)("button",{className:"tab-button ".concat("signup"===t?"active":""),onClick:()=>a("signup"),children:"Sign Up"})]}),Object(j.jsx)("div",{className:"form-container",children:"login"===t?Object(j.jsx)(m,{}):Object(j.jsx)(O,{})})]})})},x=(a(153),a(337));const f=(e,t,a,s)=>a<e.length-1&&(e[a+1].sender._id!==t.sender._id||void 0===e[a+1].sender._id)&&e[a].sender._id!==s,v=(e,t,a)=>t===e.length-1&&e[e.length-1].sender._id!==a&&e[e.length-1].sender._id,y=(e,t)=>{var a;return t&&t.length>=2?(null===(a=t[0])||void 0===a?void 0:a._id)===(null===e||void 0===e?void 0:e._id)?t[1].name:t[0].name:"Nome indisponivel"};var N=a(346),C=a(338),w=a(334),S=a(335),A=a(17),E=a(340),k=a(341);a(154);var _=e=>{let{user:t,children:a}=e;const{isOpen:s,onOpen:c,onClose:o}=Object(w.a)();return Object(j.jsxs)(j.Fragment,{children:[a?Object(j.jsx)("span",{onClick:c,children:a}):Object(j.jsx)(S.a,{display:{base:"flex"},icon:Object(j.jsx)(C.a,{}),onClick:c,bg:"transparent",color:"#00a88e",_hover:{bg:"rgba(0, 168, 142, 0.1)"}}),Object(j.jsxs)(A.a,{size:"lg",onClose:o,isOpen:s,isCentered:!0,children:[Object(j.jsx)(A.h,{className:"profile-modal-overlay"}),Object(j.jsxs)(A.d,{className:"profile-modal-content",children:[Object(j.jsx)(A.g,{className:"profile-modal-header",children:t.name}),Object(j.jsx)(A.c,{className:"profile-modal-close"}),Object(j.jsx)(A.b,{className:"profile-modal-body",children:Object(j.jsxs)("div",{className:"profile-view-container",children:[Object(j.jsx)(E.a,{borderRadius:"full",boxSize:"150px",src:t.pic,alt:t.name,className:"profile-avatar-large"}),Object(j.jsxs)("div",{className:"profile-info",children:[Object(j.jsx)(k.a,{className:"profile-name",children:t.name}),Object(j.jsxs)(k.a,{className:"profile-email",children:["Email: ",t.email]})]})]})}),Object(j.jsx)(A.f,{className:"profile-modal-footer",children:Object(j.jsx)("button",{className:"btn-close-modal",onClick:o,children:"Close"})})]})]})]})},I=a(342),F=a(362),K=a(191);var P=e=>{let{messages:t}=e;const{user:a}=h();return Object(j.jsx)(K.a,{children:t&&t.map(((e,s)=>Object(j.jsxs)("div",{className:"message-wrapper ".concat(e.sender._id===a._id?"sent":"received"),children:[e.sender._id!==a._id&&(f(t,e,s,a._id)||v(t,s,a._id))&&Object(j.jsx)(F.a,{label:e.sender.name,placement:"bottom-start",hasArrow:!0,children:Object(j.jsx)(I.a,{className:"message-avatar",name:e.sender.name,src:e.sender.pic,size:"sm"})}),e.sender._id!==a._id&&!f(t,e,s,a._id)&&!v(t,s,a._id)&&Object(j.jsx)("div",{style:{width:"40px"}}),Object(j.jsx)("div",{className:"message-bubble",children:e.decrypted&&!e.decrypted.startsWith("-----BEGIN")?e.decrypted:"[Mensagem criptografada]"})]},e._id)))})},U=(a(237),a(287),a(288),a(132)),z=a.n(U),B=a(345),D=a(87),M=a(365),L=a(194),R=a(344),G=a(343);var J=e=>{let{user:t,handleFunction:a,admin:s}=e;return Object(j.jsxs)(G.a,{px:2,py:1,borderRadius:"lg",m:1,mb:2,variant:"solid",fontSize:12,colorScheme:"purple",cursor:"pointer",onClick:a,children:[t.name,s===t._id&&Object(j.jsx)("span",{children:" (Admin)"}),Object(j.jsx)(R.a,{pl:1})]})};var T=e=>{let{user:t,handleFunction:a}=e;return Object(j.jsxs)(B.a,{onClick:a,cursor:"pointer",bg:"#E8E8E8",_hover:{background:"#38B2AC",color:"white"},w:"100%",d:"flex",alignItems:"center",color:"black",px:3,py:2,mb:2,borderRadius:"lg",children:[Object(j.jsx)(I.a,{mr:2,size:"sm",cursor:"pointer",name:t.name,src:t.pic}),Object(j.jsxs)(B.a,{children:[Object(j.jsx)(k.a,{children:t.name}),Object(j.jsxs)(k.a,{fontSize:"xs",children:[Object(j.jsx)("b",{children:"Email : "}),t.email]})]})]})};var Y=e=>{let{fetchMessages:t,fetchAgain:a,setFetchAgain:c}=e;const{isOpen:o,onOpen:n,onClose:i}=Object(w.a)(),[r,b]=Object(s.useState)(),[p,u]=Object(s.useState)(""),[m,O]=Object(s.useState)([]),[g,f]=Object(s.useState)(!1),[v,y]=Object(s.useState)(!1),N=Object(d.a)(),{selectedChat:E,setSelectedChat:k,user:_}=h(),I=async e=>{if(E.users.find((t=>t._id===e._id)))N({title:"User Already in group!",status:"error",duration:5e3,isClosable:!0,position:"bottom"});else if(E.groupAdmin._id===_._id){try{f(!0);const t={headers:{Authorization:"Bearer ".concat(_.token)}},{data:s}=await l.a.put("/api/chat/groupadd",{chatId:E._id,userId:e._id},t);k(s),c(!a),f(!1)}catch(t){N({title:"Error Occured!",description:t.response.data.message,status:"error",duration:5e3,isClosable:!0,position:"bottom"}),f(!1)}b("")}else N({title:"Only admins can add someone!",status:"error",duration:5e3,isClosable:!0,position:"bottom"})},F=async e=>{if(E.groupAdmin._id===_._id||e._id===_._id){try{f(!0);const s={headers:{Authorization:"Bearer ".concat(_.token)}},{data:o}=await l.a.put("/api/chat/groupremove",{chatId:E._id,userId:e._id},s);e._id===_._id?k():k(o),c(!a),t(),f(!1)}catch(s){N({title:"Error Occured!",description:s.response.data.message,status:"error",duration:5e3,isClosable:!0,position:"bottom"}),f(!1)}b("")}else N({title:"Only admins can remove someone!",status:"error",duration:5e3,isClosable:!0,position:"bottom"})};return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(S.a,{d:{base:"flex"},icon:Object(j.jsx)(C.a,{}),onClick:n}),Object(j.jsxs)(A.a,{onClose:i,isOpen:o,isCentered:!0,children:[Object(j.jsx)(A.h,{}),Object(j.jsxs)(A.d,{children:[Object(j.jsx)(A.g,{fontSize:"35px",fontFamily:"Work sans",d:"flex",justifyContent:"center",children:E.chatName}),Object(j.jsx)(A.c,{}),Object(j.jsxs)(A.b,{d:"flex",flexDir:"column",alignItems:"center",children:[Object(j.jsx)(B.a,{w:"100%",d:"flex",flexWrap:"wrap",pb:3,children:E.users.map((e=>Object(j.jsx)(J,{user:e,admin:E.groupAdmin,handleFunction:()=>F(e)},e._id)))}),Object(j.jsxs)(D.a,{d:"flex",children:[Object(j.jsx)(M.a,{placeholder:"Chat Name",mb:3,value:r,onChange:e=>b(e.target.value)}),Object(j.jsx)(L.a,{variant:"solid",colorScheme:"teal",ml:1,isLoading:v,onClick:async()=>{if(r){try{y(!0);const e={headers:{Authorization:"Bearer ".concat(_.token)}},{data:t}=await l.a.put("/api/chat/rename",{chatId:E._id,chatName:r},e);console.log(t._id),k(t),c(!a),y(!1)}catch(e){N({title:"Error Occured!",description:e.response.data.message,status:"error",duration:5e3,isClosable:!0,position:"bottom"}),y(!1)}b("")}},children:"Update"})]}),Object(j.jsx)(D.a,{children:Object(j.jsx)(M.a,{placeholder:"Add User to group",mb:1,onChange:e=>(async e=>{if(u(e),e)try{f(!0);const e={headers:{Authorization:"Bearer ".concat(_.token)}},{data:t}=await l.a.get("/api/user?search=".concat(p),e);console.log(t),f(!1),O(t)}catch(t){N({title:"Error Occured!",description:"Failed to Load the Search Results",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"}),f(!1)}})(e.target.value)})}),g?Object(j.jsx)(x.a,{size:"lg"}):null===m||void 0===m?void 0:m.map((e=>Object(j.jsx)(T,{user:e,handleFunction:()=>I(e)},e._id)))]}),Object(j.jsx)(A.f,{children:Object(j.jsx)(L.a,{onClick:()=>F(_),colorScheme:"red",children:"Leave Group"})})]})]})]})};a(308);const H="localhost"===window.location.hostname?"http://localhost:5001":window.location.origin;let V,W;const q=async(e,t)=>{console.log("1 - Iniciando criptografia para destinat\xe1rio..."),console.log("Chave publica do destinat\xe1rio:\n",t);const a=t.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\n/g,""),s=Uint8Array.from(atob(a),(e=>e.charCodeAt(0))),c=await window.crypto.subtle.importKey("spki",s.buffer,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),o=(new TextEncoder).encode(e),n=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},c,o),i=btoa(String.fromCharCode(...new Uint8Array(n)));return console.log("\u2705 Mensagem criptografada com sucesso."),i},Q=async(e,t)=>{try{console.log("Tentando descriptografar mensagem...");const a=new Uint8Array((e=>{const t=atob(e),a=new Uint8Array(t.length);for(let s=0;s<t.length;s++)a[s]=t.charCodeAt(s);return a.buffer})(e)),s=await window.crypto.subtle.decrypt({name:"RSA-OAEP"},t,a),c=(new TextDecoder).decode(s);return console.log("\u2705 Mensagem descriptografada:",c),c}catch(a){return console.warn("\u26a0\ufe0f Falha na descriptografia (mensagem n\xe3o destinada a este usu\xe1rio)."),null}};var X=e=>{let{fetchAgain:t,setFetchAgain:a}=e;const[c,o]=Object(s.useState)([]),[n,r]=Object(s.useState)(!1),[b,p]=Object(s.useState)(""),[u,m]=Object(s.useState)(!1),[O,g]=Object(s.useState)(!1),[f,v]=Object(s.useState)(!1),[C,w]=Object(s.useState)(null),[S,A]=Object(s.useState)(null),E=Object(d.a)(),{selectedChat:k,setSelectedChat:I,user:F,notification:K,setNotification:U}=h();Object(s.useEffect)((()=>{if(!S){console.log("\ud83d\udd0c Inicializando conex\xe3o socket...");const e=z()(H,{transports:["websocket"],withCredentials:!0});e.on("connect",(()=>{console.log("\ud83d\udfe2 Conectado ao servidor Socket.IO"),m(!0),e.emit("setup",F)})),e.on("disconnect",(()=>{console.warn("\ud83d\udd34 Desconectado do Socket.IO"),m(!1)})),e.on("typing",(()=>v(!0))),e.on("stop typing",(()=>v(!1))),A(e)}}),[F]),Object(s.useEffect)((()=>{let e=!0;return(async()=>{const t=await(async()=>{try{const e=sessionStorage.getItem("privateKeyJwk");if(!e)return void console.warn("Nenhuma chave privada encontrada na sess\xe3o.");const t=JSON.parse(e),a=await window.crypto.subtle.importKey("jwk",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"]);return console.log("\u2705 Chave privada importada com sucesso da sess\xe3o."),a}catch(e){return console.error("\u274c Erro ao importar chave privada:",e),null}})();e&&t&&w(t),V||(console.log("\ud83d\udd0c Inicializando Socket.IO ->",H),V=z()(H,{transports:["polling","websocket"],withCredentials:!0}),V.on("connect",(()=>{console.log("\ud83d\udfe2 Conectado ao servidor Socket.IO"),m(!0)})),V.on("disconnect",(()=>{console.warn("\ud83d\udd34 Desconectado do Socket.IO"),m(!1)})),V.on("connected",(()=>m(!0))),V.on("typing",(()=>v(!0))),V.on("stop typing",(()=>v(!1)))),V&&F&&V.emit("setup",F)})(),()=>{e=!1}}),[F]);const B=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(k&&C){console.log(e?"\n\ud83d\udd04 Atualizando mensagens...":"\n=== BUSCANDO MENSAGENS CIFRADAS ===");try{const s={headers:{Authorization:"Bearer ".concat(F.token)}},{data:c}=await l.a.get("/api/message/".concat(k._id),s);console.log("\ud83d\udce6 ".concat(c.length," mensagens recebidas do servidor."));const n=[];for(const e of c){var t,a;if(!e.destinatario||!e.sender&&!e.chat)continue;if((null===(t=e.destinatario)||void 0===t?void 0:t._id)!==F._id&&(null===(a=e.sender)||void 0===a?void 0:a._id)!==F._id)continue;const s=await Q(e.content,C);n.push(Object(i.a)(Object(i.a)({},e),{},{decrypted:s||"[Falha ao descriptografar mensagem]"}))}o(n.filter((e=>{var t,a;return!(e.sender._id===F._id&&((null===(t=e.decrypted)||void 0===t?void 0:t.includes("Falha ao descriptografar"))||(null===(a=e.content)||void 0===a?void 0:a.includes("Falha ao descriptografar"))))}))),!e&&V&&u&&V.emit("join chat",k._id),console.log("\u2705 Todas as mensagens processadas e exibidas no chat.")}catch(s){console.error("\u274c Erro ao buscar mensagens:",s),E({title:"Erro!",description:"Falha ao carregar mensagens.",status:"error",duration:5e3,isClosable:!0,position:"bottom"})}}};Object(s.useEffect)((()=>{k&&C&&(B(!1),W=k)}),[k,C]),Object(s.useEffect)((()=>{if(!S)return;const e=async e=>{if(console.log("\ud83d\udcac Nova mensagem recebida via socket:",e),!W||W._id!==e.chat._id)return void(K.find((t=>t._id===e._id))||(U([e,...K]),a(!t)));const s=await Q(e.content,C),c=Object(i.a)(Object(i.a)({},e),{},{decrypted:s||"[Falha ao descriptografar]"});o((e=>e.some((e=>e._id===c._id))?e:[...e,c]))};return S.on("message received",e),S.on("refresh messages",(()=>B(!0))),()=>{S.off("message received",e),S.off("refresh messages")}}),[S,k,C]);const D=async e=>{const t="Enter"===(null===e||void 0===e?void 0:e.key);if((t||"click"!==(null===e||void 0===e?void 0:e.type)||b)&&(t||"click"===(null===e||void 0===e?void 0:e.type))&&b){console.log("\n=== INICIANDO ENVIO DE MENSAGEM CIFRADA ==="),V&&u&&V.emit("stop typing",k._id);try{const e={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(F.token)}},{data:t}=await l.a.get("/api/chat/".concat(k._id),e),a=[];for(const c of t.users){if(c._id===F._id)continue;const e=await q(b,c.publicKey);a.push({destinatarioId:c._id,content:e})}const s=await Promise.all(a.map((async t=>{const{data:a}=await l.a.post("/api/message",{content:t.content,chatId:k._id,destinatarioId:t.destinatarioId},e);return a})));p(""),s.forEach((e=>null===S||void 0===S?void 0:S.emit("new message",e))),o((e=>[...e,...s.filter((t=>!e.some((e=>e._id===t._id)))).map((e=>Object(i.a)(Object(i.a)({},e),{},{decrypted:b})))]))}catch(a){console.error("\u274c Erro ao enviar mensagem:",a),E({title:"Erro!",description:"Falha ao enviar mensagem.",status:"error",duration:5e3,isClosable:!0,position:"bottom"})}}};return Object(j.jsx)(j.Fragment,{children:k?Object(j.jsxs)("div",{className:"singlechat-container",children:[Object(j.jsxs)("div",{className:"chat-header",children:[Object(j.jsxs)("div",{className:"chat-header-left",children:[Object(j.jsx)("button",{className:"back-button",onClick:()=>I(""),children:Object(j.jsx)(N.a,{})}),Object(j.jsx)("h2",{className:"chat-header-title",children:k.isGroupChat?k.chatName.toUpperCase():y(F,k.users)})]}),Object(j.jsx)("div",{className:"chat-header-actions",children:k.isGroupChat?Object(j.jsx)(Y,{fetchMessages:B,fetchAgain:t,setFetchAgain:a,children:Object(j.jsx)("button",{className:"header-icon-btn",children:Object(j.jsx)("i",{className:"fas fa-cog"})})}):Object(j.jsx)(_,{user:(M=F,L=k.users,L[0]._id===M._id?L[1]:L[0]),children:Object(j.jsx)("button",{className:"header-icon-btn",children:Object(j.jsx)("i",{className:"fas fa-info-circle"})})})})]}),Object(j.jsxs)("div",{className:"messages-container",children:[n?Object(j.jsx)("div",{className:"messages-loading",children:Object(j.jsx)(x.a,{size:"xl",color:"#00a88e"})}):Object(j.jsx)(P,{messages:c}),f&&Object(j.jsxs)("div",{className:"typing-indicator",children:[Object(j.jsx)("div",{className:"typing-dot"}),Object(j.jsx)("div",{className:"typing-dot"}),Object(j.jsx)("div",{className:"typing-dot"})]})]}),Object(j.jsx)("div",{className:"message-input-container",children:Object(j.jsxs)("div",{className:"message-input-wrapper",children:[Object(j.jsx)("input",{className:"message-input",placeholder:"Enter a message...",value:b,onChange:e=>{if(p(e.target.value),!u)return;O||(g(!0),V.emit("typing",k._id));let t=(new Date).getTime();setTimeout((()=>{(new Date).getTime()-t>=3e3&&O&&(V.emit("stop typing",k._id),g(!1))}),3e3)},onKeyDown:D}),Object(j.jsx)("button",{className:"send-button",onClick:e=>D(Object(i.a)(Object(i.a)({},e),{},{key:"Enter",type:"click"})),disabled:!b.trim(),children:"Send"})]})})]}):Object(j.jsxs)("div",{className:"empty-chat-state",children:[Object(j.jsx)("div",{className:"empty-chat-icon",children:"\ud83d\udcac"}),Object(j.jsx)("div",{className:"empty-chat-text",children:"Click on a user to start chatting"})]})});var M,L};a(309);var Z=e=>{let{fetchAgain:t,setFetchAgain:a}=e;const{selectedChat:s}=h();return Object(j.jsx)("div",{className:"chatbox-container",children:s?Object(j.jsx)(X,{fetchAgain:t,setFetchAgain:a}):Object(j.jsx)("div",{className:"chatbox-empty",children:"Click on a user to start chatting"})})},$=a(348),ee=a(366),te=a(361);var ae=()=>Object(j.jsxs)(ee.a,{children:[Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"}),Object(j.jsx)(te.a,{height:"45px"})]});var se=e=>{let{children:t}=e;const{isOpen:a,onOpen:c,onClose:o}=Object(w.a)(),[n,i]=Object(s.useState)(),[r,b]=Object(s.useState)([]),[p,u]=Object(s.useState)(""),[m,O]=Object(s.useState)([]),[g,x]=Object(s.useState)(!1),f=Object(d.a)(),{user:v,chats:y,setChats:N}=h();return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{onClick:c,children:t}),Object(j.jsxs)(A.a,{onClose:o,isOpen:a,isCentered:!0,children:[Object(j.jsx)(A.h,{}),Object(j.jsxs)(A.d,{children:[Object(j.jsx)(A.g,{fontSize:"35px",fontFamily:"Work sans",d:"flex",justifyContent:"center",children:"Create Group Chat"}),Object(j.jsx)(A.c,{}),Object(j.jsxs)(A.b,{d:"flex",flexDir:"column",alignItems:"center",children:[Object(j.jsx)(D.a,{children:Object(j.jsx)(M.a,{placeholder:"Chat Name",mb:3,onChange:e=>i(e.target.value)})}),Object(j.jsx)(D.a,{children:Object(j.jsx)(M.a,{placeholder:"Add Users eg: John, Piyush, Jane",mb:1,onChange:e=>(async e=>{if(u(e),e)try{x(!0);const e={headers:{Authorization:"Bearer ".concat(v.token)}},{data:t}=await l.a.get("/api/user?search=".concat(p),e);console.log(t),x(!1),O(t)}catch(t){f({title:"Error Occured!",description:"Failed to Load the Search Results",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}})(e.target.value)})}),Object(j.jsx)(B.a,{w:"100%",d:"flex",flexWrap:"wrap",children:r.map((e=>Object(j.jsx)(J,{user:e,handleFunction:()=>{return t=e,void b(r.filter((e=>e._id!==t._id)));var t}},e._id)))}),g?Object(j.jsx)("div",{children:"Loading..."}):null===m||void 0===m?void 0:m.slice(0,4).map((e=>Object(j.jsx)(T,{user:e,handleFunction:()=>{return t=e,void(r.includes(t)?f({title:"User already added",status:"warning",duration:5e3,isClosable:!0,position:"top"}):b([...r,t]));var t}},e._id)))]}),Object(j.jsx)(A.f,{children:Object(j.jsx)(L.a,{onClick:async()=>{if(n&&r)try{const e={headers:{Authorization:"Bearer ".concat(v.token)}},{data:t}=await l.a.post("/api/chat/group",{name:n,users:JSON.stringify(r.map((e=>e._id)))},e);N([t,...y]),o(),f({title:"New Group Chat Created!",status:"success",duration:5e3,isClosable:!0,position:"bottom"})}catch(e){f({title:"Failed to Create the Chat!",description:e.response.data,status:"error",duration:5e3,isClosable:!0,position:"bottom"})}else f({title:"Please fill all the feilds",status:"warning",duration:5e3,isClosable:!0,position:"top"})},colorScheme:"blue",children:"Create Chat"})})]})]})]})};a(310);var ce=e=>{let{fetchAgain:t}=e;const[a,c]=Object(s.useState)(),[o,n]=Object(s.useState)([]),[i,r]=Object(s.useState)(!1),[b,p]=Object(s.useState)("chats"),{selectedChat:u,setSelectedChat:m,user:O,chats:g,setChats:x}=h(),f=Object(d.a)();return Object(s.useEffect)((()=>{c(JSON.parse(localStorage.getItem("userInfo"))),(async()=>{try{const e={headers:{Authorization:"Bearer ".concat(O.token)}},{data:t}=await l.a.get("/api/chat",e);x(t)}catch(e){f({title:"Error Occurred!",description:"Failed to Load the chats",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}})(),(async()=>{try{r(!0);const e={headers:{Authorization:"Bearer ".concat(O.token)}},{data:t}=await l.a.get("/api/user",e);n(t),r(!1)}catch(e){f({title:"Error Occurred!",description:"Failed to Load available users",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"}),r(!1)}})()}),[t]),Object(j.jsxs)("div",{className:"mychats-container",children:[Object(j.jsxs)("div",{className:"mychats-header",children:[Object(j.jsx)("h2",{className:"mychats-title",children:"My Chats"}),Object(j.jsx)(se,{children:Object(j.jsxs)("button",{className:"new-group-btn",children:[Object(j.jsx)($.a,{}),Object(j.jsx)("span",{children:"New Group"})]})})]}),Object(j.jsx)("div",{className:"chats-tabs",children:Object(j.jsxs)("div",{className:"tabs-list",children:[Object(j.jsxs)("button",{className:"tab-btn ".concat("chats"===b?"active":""),onClick:()=>p("chats"),children:["Chats (",g?g.length:0,")"]}),Object(j.jsxs)("button",{className:"tab-btn ".concat("users"===b?"active":""),onClick:()=>p("users"),children:["Users (",o.length,")"]})]})}),Object(j.jsx)("div",{className:"chats-list-container",children:"chats"===b?Object(j.jsx)(j.Fragment,{children:g&&g.length>0?g.map((e=>{var t,s,c;return Object(j.jsxs)("div",{className:"chat-item ".concat(u===e?"active":""),onClick:()=>m(e),children:[Object(j.jsx)("div",{className:"chat-avatar",children:e.isGroupChat?null===(c=e.chatName[0])||void 0===c?void 0:c.toUpperCase():null===(t=y(a,e.users))||void 0===t||null===(s=t[0])||void 0===s?void 0:s.toUpperCase()}),Object(j.jsxs)("div",{className:"chat-info",children:[Object(j.jsx)("div",{className:"chat-name",children:e.isGroupChat?e.chatName:y(a,e.users)}),e.latestMessage&&Object(j.jsxs)("div",{className:"chat-last-message",children:[Object(j.jsxs)("b",{children:[e.latestMessage.sender.name,": "]}),e.latestMessage.content.length>40?e.latestMessage.content.substring(0,41)+"...":e.latestMessage.content]})]})]},e._id)})):Object(j.jsx)("div",{className:"empty-state",children:"No chats yet. Go to Users tab to start a conversation!"})}):Object(j.jsx)(j.Fragment,{children:i?Object(j.jsx)(ae,{}):o.length>0?o.map((e=>Object(j.jsxs)("div",{className:"chat-item",onClick:()=>(async e=>{try{const t={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(O.token)}},{data:a}=await l.a.post("/api/chat",{userId:e},t);g.find((e=>e._id===a._id))||x([a,...g]),m(a),f({title:"Chat Started!",status:"success",duration:3e3,isClosable:!0,position:"bottom"})}catch(t){f({title:"Error fetching the chat",description:t.message,status:"error",duration:5e3,isClosable:!0,position:"bottom-left"})}})(e._id),children:[Object(j.jsx)(I.a,{size:"sm",name:e.name,src:e.pic,className:"chat-avatar"}),Object(j.jsxs)("div",{className:"chat-info",children:[Object(j.jsx)("div",{className:"chat-name",children:e.name}),Object(j.jsx)("div",{className:"chat-last-message",children:e.email})]})]},e._id))):Object(j.jsx)("div",{className:"empty-state",children:"No users available"})})})]})},oe=a(359),ne=a(367),ie=a(353),re=a(354),le=a(103),de=a.n(le),je=a(349),be=a(350),he=a(351),pe=a(352);var ue=e=>{let{children:t}=e;const{isOpen:a,onOpen:c,onClose:o}=Object(w.a)(),[i,r]=Object(s.useState)(!1),[b,p]=Object(s.useState)(!1),u=Object(s.useRef)(),m=Object(d.a)(),O=Object(n.e)(),{user:g,setUser:x}=h(),[f,v]=Object(s.useState)(g.name),[y,N]=Object(s.useState)(g.email),[C,S]=Object(s.useState)(""),[E,_]=Object(s.useState)(""),[F,K]=Object(s.useState)(g.pic),[P,U]=Object(s.useState)(!1),[z,R]=Object(s.useState)(!1),G=()=>R(!z),J=()=>r(!1);return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("span",{onClick:c,children:t}),Object(j.jsxs)(A.a,{size:"lg",onClose:o,isOpen:a,isCentered:!0,children:[Object(j.jsx)(A.h,{className:"profile-modal-overlay"}),Object(j.jsxs)(A.d,{className:"profile-modal-content",children:[Object(j.jsx)(A.g,{className:"profile-modal-header",children:"My Profile"}),Object(j.jsx)(A.c,{className:"profile-modal-close"}),Object(j.jsx)(A.b,{className:"profile-modal-body",children:b?Object(j.jsxs)(ee.b,{spacing:4,className:"profile-edit-container",children:[Object(j.jsx)(I.a,{size:"xl",name:f,src:F,className:"profile-avatar-medium"}),Object(j.jsxs)(D.a,{className:"form-control-profile",children:[Object(j.jsx)(je.a,{className:"form-label-profile",children:"Name"}),Object(j.jsx)(M.a,{value:f,onChange:e=>v(e.target.value),className:"form-input-profile"})]}),Object(j.jsxs)(D.a,{className:"form-control-profile",children:[Object(j.jsx)(je.a,{className:"form-label-profile",children:"Email"}),Object(j.jsx)(M.a,{type:"email",value:y,onChange:e=>N(e.target.value),className:"form-input-profile"})]}),Object(j.jsxs)(D.a,{className:"form-control-profile",children:[Object(j.jsx)(je.a,{className:"form-label-profile",children:"New Password (leave blank to keep current)"}),Object(j.jsxs)(be.a,{className:"input-group-profile",children:[Object(j.jsx)(M.a,{type:z?"text":"password",value:C,onChange:e=>S(e.target.value),placeholder:"Enter new password",className:"form-input-profile"}),Object(j.jsx)(he.a,{className:"input-right-element-profile",children:Object(j.jsx)(L.a,{h:"1.75rem",size:"sm",onClick:G,className:"show-password-profile",children:z?"Hide":"Show"})})]})]}),C&&Object(j.jsxs)(D.a,{className:"form-control-profile",children:[Object(j.jsx)(je.a,{className:"form-label-profile",children:"Confirm New Password"}),Object(j.jsxs)(be.a,{className:"input-group-profile",children:[Object(j.jsx)(M.a,{type:z?"text":"password",value:E,onChange:e=>_(e.target.value),placeholder:"Confirm new password",className:"form-input-profile"}),Object(j.jsx)(he.a,{className:"input-right-element-profile",children:Object(j.jsx)(L.a,{h:"1.75rem",size:"sm",onClick:G,className:"show-password-profile",children:z?"Hide":"Show"})})]})]}),Object(j.jsxs)(D.a,{className:"form-control-profile",children:[Object(j.jsx)(je.a,{className:"form-label-profile",children:"Update Profile Picture"}),Object(j.jsx)(M.a,{type:"file",p:1.5,accept:"image/*",onChange:e=>(e=>{if(U(!0),void 0===e)return m({title:"Please Select an Image!",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),void U(!1);if("image/jpeg"===e.type||"image/png"===e.type){const t=new FormData;t.append("file",e),t.append("upload_preset","chat-app"),t.append("cloud_name","piyushproj"),fetch("https://api.cloudinary.com/v1_1/piyushproj/image/upload",{method:"post",body:t}).then((e=>e.json())).then((e=>{K(e.url.toString()),U(!1)})).catch((e=>{console.log(e),U(!1)}))}else m({title:"Please Select an Image!",status:"warning",duration:5e3,isClosable:!0,position:"bottom"}),U(!1)})(e.target.files[0]),className:"file-input-profile"})]}),Object(j.jsxs)(ee.b,{spacing:3,w:"100%",children:[Object(j.jsx)(L.a,{className:"profile-action-btn btn-save",onClick:async()=>{if(C&&C!==E)m({title:"Passwords Do Not Match",status:"warning",duration:5e3,isClosable:!0,position:"bottom"});else try{U(!0);const e={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(g.token)}},t={name:f,email:y,pic:F};C&&(t.password=C);const{data:a}=await l.a.put("/api/user/profile",t,e);if(m({title:"Profile Updated Successfully",status:"success",duration:5e3,isClosable:!0,position:"bottom"}),x(a),localStorage.setItem("userInfo",JSON.stringify(a)),g.name!==a.name){const e=localStorage.getItem("".concat(g.name,"_privateKey"));e&&(localStorage.setItem("".concat(a.name,"_privateKey"),e),localStorage.removeItem("".concat(g.name,"_privateKey")))}U(!1),p(!1),S(""),_("")}catch(a){var e,t;m({title:"Error Occurred!",description:(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to update profile",status:"error",duration:5e3,isClosable:!0,position:"bottom"}),U(!1)}},isLoading:P,w:"100%",children:"Save Changes"}),Object(j.jsx)(L.a,{className:"profile-action-btn btn-cancel",onClick:()=>{p(!1),v(g.name),N(g.email),K(g.pic),S(""),_("")},w:"100%",children:"Cancel"})]})]}):Object(j.jsxs)(ee.b,{spacing:6,className:"profile-view-container",children:[Object(j.jsx)(I.a,{size:"2xl",name:g.name,src:g.pic,className:"profile-avatar-large"}),Object(j.jsxs)(B.a,{textAlign:"center",className:"profile-info",children:[Object(j.jsx)(k.a,{className:"profile-name",children:g.name}),Object(j.jsx)(k.a,{className:"profile-email",children:g.email})]}),Object(j.jsxs)(ee.b,{spacing:3,w:"100%",children:[Object(j.jsx)(L.a,{className:"profile-action-btn btn-edit",onClick:()=>p(!0),w:"100%",children:"Edit Profile"}),Object(j.jsx)(L.a,{className:"profile-action-btn btn-delete",onClick:()=>r(!0),w:"100%",children:"Delete Account"})]})]})}),Object(j.jsx)(A.f,{className:"profile-modal-footer",children:Object(j.jsx)(L.a,{onClick:o,className:"btn-close-modal",children:"Close"})})]})]}),Object(j.jsx)(pe.a,{isOpen:i,leastDestructiveRef:u,onClose:J,children:Object(j.jsx)(A.h,{className:"alert-dialog-overlay",children:Object(j.jsxs)(pe.b,{className:"alert-dialog-content",children:[Object(j.jsx)(A.g,{className:"alert-dialog-header",children:"Delete Account"}),Object(j.jsx)(A.b,{className:"alert-dialog-body",children:"Are you sure you want to delete your account? This action cannot be undone. All your chats and messages will be permanently deleted."}),Object(j.jsxs)(A.f,{className:"alert-dialog-footer",children:[Object(j.jsx)(L.a,{ref:u,onClick:J,className:"btn-alert-cancel",children:"Cancel"}),Object(j.jsx)(L.a,{onClick:async()=>{try{const e={headers:{Authorization:"Bearer ".concat(g.token)}};await l.a.delete("/api/user/profile",e),m({title:"Account Deleted Successfully",status:"success",duration:5e3,isClosable:!0,position:"bottom"}),localStorage.removeItem("userInfo"),localStorage.removeItem("".concat(g.name,"_privateKey")),O.push("/")}catch(a){var e,t;m({title:"Error Occurred!",description:(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to delete account",status:"error",duration:5e3,isClosable:!0,position:"bottom"})}},className:"btn-alert-delete",ml:3,children:"Delete"})]})]})})})]})};a(313);var me=function(){const[e,t]=Object(s.useState)(""),[a,c]=Object(s.useState)([]),[o,i]=Object(s.useState)(!1),[r,b]=Object(s.useState)(!1),{setSelectedChat:p,user:u,notification:m,setNotification:O,chats:g,setChats:f}=h(),v=Object(d.a)(),{isOpen:N,onOpen:C,onClose:S}=Object(w.a)(),E=Object(n.e)(),k=async e=>{try{b(!0);const t={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(u.token)}},{data:a}=await l.a.post("/api/chat",{userId:e},t);g.find((e=>e._id===a._id))||f([a,...g]),p(a),b(!1),S()}catch(t){v({title:"Error fetching the chat",description:t.message,status:"error",duration:5e3,isClosable:!0,position:"bottom-left"}),b(!1)}};return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("div",{className:"sidedrawer-container",children:[Object(j.jsx)(F.a,{label:"Search Users to chat",hasArrow:!0,placement:"bottom-end",children:Object(j.jsxs)("button",{className:"search-button",onClick:C,children:[Object(j.jsx)("i",{className:"fas fa-search"}),Object(j.jsx)("span",{children:"Search User"})]})}),Object(j.jsx)("h1",{className:"app-title",children:"CryptoChat"}),Object(j.jsxs)("div",{className:"header-actions",children:[Object(j.jsxs)(oe.a,{children:[Object(j.jsxs)(oe.b,{className:"notification-btn",children:[Object(j.jsx)(de.a,{count:m.length,effect:le.Effect.SCALE}),Object(j.jsx)(ie.a,{className:"bell-icon"})]}),Object(j.jsxs)(oe.e,{className:"dropdown-menu",pl:2,children:[!m.length&&Object(j.jsx)(oe.d,{className:"dropdown-item",children:"No New Messages"}),m.map((e=>Object(j.jsx)(oe.d,{className:"dropdown-item",onClick:()=>{p(e.chat),O(m.filter((t=>t!==e)))},children:e.chat.isGroupChat?"New Message in ".concat(e.chat.chatName):"New Message from ".concat(y(u,e.chat.users))},e._id)))]})]}),Object(j.jsxs)(oe.a,{children:[Object(j.jsxs)(oe.b,{className:"user-menu-btn",children:[Object(j.jsx)(I.a,{size:"sm",cursor:"pointer",name:u.name,src:u.pic}),Object(j.jsx)(re.a,{className:"chevron-icon"})]}),Object(j.jsxs)(oe.e,{className:"dropdown-menu",children:[Object(j.jsx)(ue,{children:Object(j.jsx)(oe.d,{className:"dropdown-item",children:"My Profile"})}),Object(j.jsx)(oe.c,{}),Object(j.jsx)(oe.d,{className:"dropdown-item",onClick:()=>{localStorage.removeItem("userInfo"),E.push("/")},children:"Logout"})]})]})]})]}),Object(j.jsxs)(ne.a,{placement:"left",onClose:S,isOpen:N,children:[Object(j.jsx)(A.h,{}),Object(j.jsxs)(ne.b,{className:"search-drawer",children:[Object(j.jsx)(A.g,{className:"search-drawer-header",children:"Search Users"}),Object(j.jsxs)(A.b,{children:[Object(j.jsxs)("div",{className:"search-input-container",children:[Object(j.jsx)("input",{className:"search-input",placeholder:"Search by name or email",value:e,onChange:e=>t(e.target.value)}),Object(j.jsx)("button",{className:"search-go-btn",onClick:async()=>{if(e)try{i(!0);const t={headers:{Authorization:"Bearer ".concat(u.token)}},{data:a}=await l.a.get("/api/user?search=".concat(e),t);i(!1),c(a)}catch(t){v({title:"Error Occurred!",description:"Failed to Load the Search Results",status:"error",duration:5e3,isClosable:!0,position:"bottom-left"}),i(!1)}else v({title:"Please Enter something in search",status:"warning",duration:5e3,isClosable:!0,position:"top-left"})},children:"Go"})]}),o?Object(j.jsx)(ae,{}):null===a||void 0===a?void 0:a.map((e=>Object(j.jsx)(T,{user:e,handleFunction:()=>k(e._id)},e._id))),r&&Object(j.jsx)(x.a,{ml:"auto",d:"flex",color:"#00a88e"})]})]})]})]})};a(314);var Oe=()=>{const[e,t]=Object(s.useState)(!1),{user:a}=h();return Object(j.jsxs)("div",{className:"chatpage-container",children:[a&&Object(j.jsx)(me,{}),Object(j.jsxs)("div",{className:"chat-content",children:[a&&Object(j.jsx)(ce,{fetchAgain:e}),a&&Object(j.jsx)(Z,{fetchAgain:e,setFetchAgain:t})]})]})};a(180);var ge=function(){return Object(j.jsxs)("div",{className:"App",children:[Object(j.jsx)(n.a,{path:"/",component:g,exact:!0}),Object(j.jsx)(n.a,{path:"/chats",component:Oe})]})};var xe=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,368)).then((t=>{let{getCLS:a,getFID:s,getFCP:c,getLCP:o,getTTFB:n}=t;a(e),s(e),c(e),o(e),n(e)}))},fe=a(355),ve=a(360),ye=a(64);const Ne=Object(fe.a)({colors:{brand:{50:"#e6f7f5",100:"#b3e8e0",200:"#80d9cb",300:"#4dcab6",400:"#1abba1",500:"#00a88e",600:"#008a73",700:"#006b58",800:"#004d3e",900:"#002e23"},navy:{50:"#e8eaf6",100:"#c5cbe9",200:"#a1abdc",300:"#7e8ccf",400:"#5a6dc2",500:"#374ea8",600:"#2d3e86",700:"#232f65",800:"#192044",900:"#0f1123"}},config:{initialColorMode:"dark",useSystemColorMode:!1},styles:{global:{body:{bg:"navy.900",color:"white"}}},zIndices:{hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800}});o.a.render(Object(j.jsx)(ve.a,{theme:Ne,children:Object(j.jsx)(ye.a,{children:Object(j.jsx)(p,{children:Object(j.jsx)(ge,{})})})}),document.getElementById("root")),xe()}},[[315,1,2]]]);
//# sourceMappingURL=main.c7637ac3.chunk.js.map